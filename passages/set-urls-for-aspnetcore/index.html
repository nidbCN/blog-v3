<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content=" 文章由我翻译自5 ways to set the URLs for an ASP.NET Core app。本人文化水平不高，可能有误译，但是大致内容应该没有问题，还请多海涵。\n版权声明：本文:5 ways to set the URLs for an ASP.NET Core app为Andrew Lock原创，依据 CC BY-SA 4.0 许可证进行授权，转载请附上出处链接及本声明。\n"><title>为 ASP.NET Core 自定义监听 Url 和端口的五种办法</title>
<link rel=canonical href=https://blog.gaein.cn/passages/set-urls-for-aspnetcore/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="为 ASP.NET Core 自定义监听 Url 和端口的五种办法"><meta property='og:description' content=" 文章由我翻译自5 ways to set the URLs for an ASP.NET Core app。本人文化水平不高，可能有误译，但是大致内容应该没有问题，还请多海涵。\n版权声明：本文:5 ways to set the URLs for an ASP.NET Core app为Andrew Lock原创，依据 CC BY-SA 4.0 许可证进行授权，转载请附上出处链接及本声明。\n"><meta property='og:url' content='https://blog.gaein.cn/passages/set-urls-for-aspnetcore/'><meta property='og:site_name' content='Gaein nidb 的博客'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='CSharp'><meta property='article:tag' content='dotNET'><meta property='article:tag' content='AspNetCore'><meta property='article:tag' content='编程'><meta property='article:tag' content='翻译'><meta property='article:tag' content='后端'><meta property='article:published_time' content='2021-04-04T03:18:28+08:00'><meta property='article:modified_time' content='2025-01-13T22:55:00+08:00'><meta name=twitter:title content="为 ASP.NET Core 自定义监听 Url 和端口的五种办法"><meta name=twitter:description content=" 文章由我翻译自5 ways to set the URLs for an ASP.NET Core app。本人文化水平不高，可能有误译，但是大致内容应该没有问题，还请多海涵。\n版权声明：本文:5 ways to set the URLs for an ASP.NET Core app为Andrew Lock原创，依据 CC BY-SA 4.0 许可证进行授权，转载请附上出处链接及本声明。\n"><link rel="shortcut icon" href=https://img.cdn.gaein.cn/favicon.ico><head><meta itemprop=name content="为 ASP.NET Core 自定义监听 Url 和端口的五种办法"><meta itemprop=image content="http://img.cdn.gaein.cn/website_used/avatars/avatar-256x.webp"><meta itemprop=description content="
文章由我翻译自5 ways to set the URLs for an ASP.NET Core app。本人文化水平不高，可能有误译，但是大致内容应该没有问题，还请多海涵。

版权声明：本文:5 ways to set the URLs for an ASP.NET Core app为Andrew Lock原创，依据 CC BY-SA 4.0 许可证进行授权，转载请附上出处链接及本声明。"></head></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar-256x_hu_d97b16840c038ea4.webp width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🥰</span></figure><div class=site-meta><h1 class=site-name><a href=/>Gaein nidb 的博客</a></h1><h2 class=site-description>记录生活</h2></div></header><ol class=menu-social><li><a href=https://github.com/nidbCN target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=https://gaein.cn><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>首页</span></a></li><li><a href=/><svg class="icon icon-tabler icon-tabler-library" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 3m0 2.667A2.667 2.667.0 019.667 3h8.666A2.667 2.667.0 0121 5.667v8.666A2.667 2.667.0 0118.333 17H9.667A2.667 2.667.0 017 14.333z"/><path d="M4.012 7.26A2.005 2.005.0 003 8.997v10c0 1.1.9 2 2 2h10c.75.0 1.158-.385 1.5-1"/><path d="M11 7h5"/><path d="M11 10h6"/><path d="M11 13h3"/></svg>
<span>博客</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>搜索</span></a></li><li><a href=https://www.gaein.cn/friends><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>链接</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#为-aspnet-core-自定义监听-url-和端口的五种办法>为 ASP.NET Core 自定义监听 Url 和端口的五种办法</a><ol><li><a href=#你能用什么样的urls>你能用什么样的URLs</a></li><li><a href=#useurls>UseUrls()</a></li><li><a href=#环境变量>环境变量</a></li><li><a href=#命令行参数>命令行参数</a></li><li><a href=#launchsettingsjson>launchSettings.json</a></li><li><a href=#kestrelserveroptionslisten>KestrelServerOptions.Listen()</a></li><li><a href=#总结>总结</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E4%BB%A3%E7%A0%81%E5%A6%82%E8%AF%97/>代码如诗</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/passages/set-urls-for-aspnetcore/>为 ASP.NET Core 自定义监听 Url 和端口的五种办法</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2021 Apr 04</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 6 分钟</time></div></footer></div></header><section class=article-content><blockquote><p>文章由我翻译自<a class=link href=https://andrewlock.net/5-ways-to-set-the-urls-for-an-aspnetcore-app/ target=_blank rel=noopener>5 ways to set the URLs for an ASP.NET Core app</a>。本人文化水平不高，可能有误译，但是大致内容应该没有问题，还请多海涵。</p></blockquote><blockquote><p>版权声明：本文:<a class=link href=https://andrewlock.net/5-ways-to-set-the-urls-for-an-aspnetcore-app/ target=_blank rel=noopener>5 ways to set the URLs for an ASP.NET Core app</a>为<a class=link href=https://andrewlock.net/about/ target=_blank rel=noopener>Andrew Lock</a>原创，依据 <a class=link href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank rel=noopener>CC BY-SA 4.0</a> 许可证进行授权，转载请附上出处链接及本声明。</p></blockquote><h2 id=为-aspnet-core-自定义监听-url-和端口的五种办法>为 ASP.NET Core 自定义监听 Url 和端口的五种办法</h2><p>默认情况下，ASP.NET Core应用程序监听以下地址：</p><ul><li>http://localhost:5000</li><li>https://localhost:5001</li></ul><p>在这篇文章里我将给出 5 种不同的办法来改变你的应用程序监听的地址。</p><p>在启动程序的时候改变 ASP.NET Core 监听地址有很多种办法。我有一篇<a class=link href=https://andrewlock.net/configuring-urls-with-kestrel-iis-and-iis-express-with-asp-net-core/ target=_blank rel=noopener>旧博客</a>指出了在 ASP.NET Core 1.0 中可选的几种办法，这些办法在 ASP.NET Core 3.x 中大致是相同的：</p><ul><li><code>UseUrls()</code> —— 在 <em>Program.cs</em> 中写死；</li><li>环境变量 —— 使用 <code>DOTNET_URLS</code> 或者 <code>ASPNETCORE_URLS</code> 来设置；</li><li>命令行参数 —— 从命令行启动时使用 <code>--urls</code> 参数来设置；</li><li>使用 <code>launchSettings.json</code> —— 在 <code>applicationUrl</code> 这个节点中设置；</li><li><code>KestrelServerOptions.Listen()</code> —— 手动使用 <code>Listen()</code> 为 Kestrel 服务器设置地址。</li></ul><p>在下面我们来看各个办法的详细说明。</p><h3 id=你能用什么样的urls>你能用什么样的URLs</h3><p>在这篇文章里我说了你可以监听的 &ldquo;URLs&rdquo;，但是你不可能去使用一个随意的、毫无章法 URL。这有 3 类 URL 可以用来监听。</p><ul><li>IPv4 和 IPv6 的本机环回地址（例如 <code>http://localhost:5000</code>）。它的格式为:<code>{协议}://{回路网络接口地址}:{端口}</code>；</li><li>你机器上的某个特定 IP 地址（例如 <code>http://192.168.8.31:5005</code>）。它的格式为:<code>{协议}://{IP地址}:{端口}</code>；</li><li>指定端口的全部 IP 地址（例如 <code>http://*:6264</code>）。它的格式为:<code>{协议}://*:{端口}</code>。</li></ul><p><code>port</code> 在上述模式中也是可选的 —— 如果你省略了它，将会使用方案的默认端口（<code>https</code> 端口是 <code>80</code>，<code>https</code> 的端口是 <code>443</code>）。</p><p>上述模式中你选择那种取决于你的部署机制。比方说，你在一台服务器上托管多个应用程序，你需要设置明确的IP地址。如果你在容器中托管，一般来说你可以使用地址 <code>localhost</code>。</p><blockquote><p>注意观察 “任意” IP 地址的格式 —— 你不一定必须要用 <code>*</code>，你可以使用一切不是 IP 地址也不是 <code>localhost</code> 的地址。也就是说，你可以使用像 <code>http://*</code>、<code>http://+</code>，<code>http://mydomain</code> 或者 <code>http://example.org</code>。所有这些都会有相同的行为，并且监听任何 IP。如果你只想处理某个特定的域名的请求，你需要额外设置 <a class=link href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-3.1##host-filtering" target=_blank rel=noopener>host filtering</a>。</p></blockquote><p>当你知道你需要你的程序监听那些 URLs 时，你需要告诉你的程序这些事。在这篇博客里我写了设置这些的 5 种可能的方法。</p><h3 id=useurls>UseUrls()</h3><p>第一种、并且也是最简单的设置绑定 URL 的的办法是在 <code>IWebHostBuilder</code> 中使用 <code>UseUrls()</code> 写死：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Program</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=k>void</span> <span class=n>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>CreateHostBuilder</span><span class=p>(</span><span class=n>args</span><span class=p>).</span><span class=n>Build</span><span class=p>().</span><span class=n>Run</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IHostBuilder</span> <span class=n>CreateHostBuilder</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=n>Host</span><span class=p>.</span><span class=n>CreateDefaultBuilder</span><span class=p>(</span><span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>ConfigureWebHostDefaults</span><span class=p>(</span><span class=n>webBuilder</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>webBuilder</span><span class=p>.</span><span class=n>UseStartup</span><span class=p>&lt;</span><span class=n>Startup</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>                <span class=n>webBuilder</span><span class=p>.</span><span class=n>UseUrls</span><span class=p>(</span><span class=s>&#34;http://localhost:5003&#34;</span><span class=p>,</span> <span class=s>&#34;https://localhost:5004&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>把 URLs 写死看起来并不是一个优雅且可拓展的解决方法，所以这个方法并不怎么用在实际使用中。</p><p>幸运的是，你仍旧可以从外部配置文件、环境变量活命令行参数中设置 URLs。</p><h3 id=环境变量>环境变量</h3><p>.NET Core使用两 <em>种</em> 设置：</p><ul><li><strong>App设置</strong> 是你通常所使用的，并且从 <em>appSettings.json</em> 、环境变量以及其它地方加载。</li><li><strong>Host设置</strong> 是用来设置基础的东西的，比如 <a class=link href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/environments?view=aspnetcore-3.1" target=_blank rel=noopener>hosting环境变量</a> 和 host 使用的 URL。</li></ul><p>当考虑如何为应用程序设置 URLs 时，我们感兴趣的办法是 <em>Host设置</em> 。默认情况下，host设置的值从三个不同的源读取：</p><ul><li>带有 <code>DOTNET_</code> 前缀的环境变量。这些环境变量被去除了前缀添加到集合里面；</li><li>命令行参数；</li><li>带有 <code>ASPNETCORE_</code> 前缀的环境变量，这些环境变量也被添加到了集合里面，仅对 ASP.NET Core 应用程序有作用。如果你创建了一个.NET 通用主机的服务，那么这些环境变量将不会添加；</li></ul><p>如果你不手动重写方法 <code>UseUrls()</code>，ASP.NET Core 将会使用从设置系统中读取的 <code>URLS</code> 键对应的值。基于前文，你可以使用两个环境变量中的任意一个设置 URLs：</p><ul><li>DOTNET_URLS</li><li>ASPNETCORE_URLS</li></ul><blockquote><p>如果你同时设置了两个环境变量， <code>ASPNETCORE_URLS</code> 的参数将会优先被使用。</p></blockquote><p>你可以像通常做的那样在你的环境中设置环境变量。比如，使用命令提示符：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cmd data-lang=cmd><span class=line><span class=cl>setx ASPNETCORE_URLS <span class=s2>&#34;http://localhost:5001&#34;</span> 
</span></span></code></pre></td></tr></table></div></div><p>使用PowerShell：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ps1 data-lang=ps1><span class=line><span class=cl><span class=nv>$Env</span><span class=err>:</span> <span class=n>ASPNETCORE_URLS</span> <span class=p>=</span> <span class=s2>&#34;http://localhost:5001&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>或者是在bash里：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>ASPNETCORE_URLS</span><span class=o>=</span><span class=s2>&#34;http://localhost:5001;https://localhost:5002&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>就像你在上面看到的那样，你可以通过用分号分割它们来传递多个被监听的地址（用HTTP和HTTPS都行）。</p><blockquote><p><a class=link href=https://disq.us/p/28v6d6c target=_blank rel=noopener>Marc在评论中</a>指出，如果你在 Docker 中运行它，<a class=link href=https://github.com/dotnet/dotnet-docker/blob/402a1591e224b681015be628986eefa5012e940e/3.1/runtime-deps/alpine3.11/amd64/Dockerfile##L15 target=_blank rel=noopener>Dockerfile 会将 <code>ASPNETCORE_URLS</code> 环境变量设置为端口 80</a></p></blockquote><h3 id=命令行参数>命令行参数</h3><p>另外一个设置host设置值的办法是使用命令行。如果设置了环境变量则命令行参数会重写它们。只需要使用 <code>--urls</code> 参数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dotnet run --urls <span class=s2>&#34;http://localhost:5100&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>像前面那样，你可以通过用分号分割来传递多个 URLs：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dotnet run --urls <span class=s2>&#34;http://localhost:5100;https://localhost:5101&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>环境变量和命令行参数可能是生产环境中设置 URLs 用的最多的办法了，但是对于在本地开发来说可能略显繁琐，因此在本地开发通常简单的使用 <em>launchSettings.json</em></p><h3 id=launchsettingsjson>launchSettings.json</h3><p>大部分 ASP.NET 项目模板在 <code>Properties</code> 文件夹中包含 <code>launchSettings.json</code> 文件。这个文件包含了启动 ASP.NET Core 应用程序的几种配置。一个典型的例子是包含从命令行直接启动选项的定义还有一个使用 IIS Express。该文件配置了 Visual Studio 中 Debug 的下拉菜单：</p><p><img src=https://img.cdn.gaein.cn/blog/posts/AspNetCore-Set-Urls/launchsettings.png loading=lazy alt="Visual Studio"></p><p><em>launchSettings.json</em> 通过 <code>applicationUrl</code> 节点提供了一个设置 URL 的简单办法 —— 你还可以看见 <code>iisSettings</code> 里面的 IIS express 设置，以及另外一个 <code>TestApp</code> （应用程序的名称）。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;iisSettings&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;windowsAuthentication&#34;</span><span class=p>:</span> <span class=kc>false</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;anonymousAuthentication&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>    <span class=nt>&#34;iisExpress&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;applicationUrl&#34;</span><span class=p>:</span> <span class=s2>&#34;http://localhost:38327&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;sslPort&#34;</span><span class=p>:</span> <span class=mi>44310</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;profiles&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;IIS Express&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;commandName&#34;</span><span class=p>:</span> <span class=s2>&#34;IISExpress&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;launchBrowser&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;environmentVariables&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;ASPNETCORE_ENVIRONMENT&#34;</span><span class=p>:</span> <span class=s2>&#34;Development&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;TestApp&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;commandName&#34;</span><span class=p>:</span> <span class=s2>&#34;Project&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;launchBrowser&#34;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;applicationUrl&#34;</span><span class=p>:</span> <span class=s2>&#34;https://localhost:5001;http://localhost:5000&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;environmentVariables&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;ASPNETCORE_ENVIRONMENT&#34;</span><span class=p>:</span> <span class=s2>&#34;Development&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>想要使用这个文件你不需要做任何特别的设置 —— <code>dotnet run</code> 将会自动使用它。</p><blockquote><p>launchSettings.json 同时也提供了一种方便简单的办法使用 <code>environmentVariables</code> 节点来添加环境变量，你可以从上面的文件看出来这点。</p></blockquote><p>当你从命令行使用 <code>dotnet run</code> 运行你的应用程序，你的程序将会使用上面文件中指定的“项目”中的 <code>applicationUrl</code> 节点中的 URLs <code>https://localhost:5001;http://localhost:5000</code>。当你使用 &ldquo;IISExpress&rdquo; 选项的时候，你的应用程序会使用 <code>iisSettings.iisExpress</code> 中的 <code>applicationUrl</code>。</p><p>当你在本地开发时可以使用这个文件非常轻易的修改环境变量。事实上你还可以 <em>不</em> 使用这个 <em>launchSettings.json</em> 文件:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dotnet run --no-launch-profile
</span></span></code></pre></td></tr></table></div></div><p>这将会跳过 <code>launchSettings.json</code> 文件并且使用本机的环境变量来内部确定URLs。</p><p>所有的这些办法都是简介的对 Kestrel 的间接设置，但你仍然可以直接设置它们。</p><h3 id=kestrelserveroptionslisten>KestrelServerOptions.Listen()</h3><p>在大部分ASP.NET Core程序中，<a class=link href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-3.1" target=_blank rel=noopener>Kestrel</a>被设置为默认的服务器。如果你想的话可以手动设置为 Kestrel 设置端点，或者通过 <code>IConfiguration</code> 系统去配置 <code>KestrelServerOptions</code>。</p><p>我从来没有真正需要去设置这个的时候，并且这个玩意有非常大量的选项可以用。所以，通常情况下我建议<a class=link href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-3.1##endpoint-configuration" target=_blank rel=noopener>参考文档</a>。举个例子，你可以使用被 <code>KestrelServerOptions</code> 暴露的 <code>Listen()</code> 方法。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cs data-lang=cs><span class=line><span class=cl><span class=kd>public</span> <span class=k>class</span> <span class=nc>Program</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=k>void</span> <span class=n>Main</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>CreateHostBuilder</span><span class=p>(</span><span class=n>args</span><span class=p>).</span><span class=n>Build</span><span class=p>().</span><span class=n>Run</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kd>static</span> <span class=n>IHostBuilder</span> <span class=n>CreateHostBuilder</span><span class=p>(</span><span class=kt>string</span><span class=p>[]</span> <span class=n>args</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>        <span class=n>Host</span><span class=p>.</span><span class=n>CreateDefaultBuilder</span><span class=p>(</span><span class=n>args</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>.</span><span class=n>ConfigureWebHostDefaults</span><span class=p>(</span><span class=n>webBuilder</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>webBuilder</span><span class=p>.</span><span class=n>UseStartup</span><span class=p>&lt;</span><span class=n>Startup</span><span class=p>&gt;();</span>
</span></span><span class=line><span class=cl>                <span class=n>webBuilder</span><span class=p>.</span><span class=n>UseKestrel</span><span class=p>(</span><span class=n>opts</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>                <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// 直接绑定套接字句柄或者Unix套接字</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// opts.ListenHandle(123554);</span>
</span></span><span class=line><span class=cl>                    <span class=c1>// opts.ListenUnixSocket(&#34;/tmp/kestrel-test.sock&#34;);</span>
</span></span><span class=line><span class=cl>                    <span class=n>opts</span><span class=p>.</span><span class=n>Listen</span><span class=p>(</span><span class=n>IPAddress</span><span class=p>.</span><span class=n>Loopback</span><span class=p>,</span> <span class=n>port</span><span class=p>:</span> <span class=m>5002</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>opts</span><span class=p>.</span><span class=n>ListenAnyIP</span><span class=p>(</span><span class=m>5003</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                    <span class=n>opts</span><span class=p>.</span><span class=n>ListenLocalhost</span><span class=p>(</span><span class=m>5004</span><span class=p>,</span> <span class=n>opts</span> <span class=p>=&gt;</span> <span class=n>opts</span><span class=p>.</span><span class=n>UseHttps</span><span class=p>());</span>
</span></span><span class=line><span class=cl>                    <span class=n>opts</span><span class=p>.</span><span class=n>ListenLocalhost</span><span class=p>(</span><span class=m>5005</span><span class=p>,</span> <span class=n>opts</span> <span class=p>=&gt;</span> <span class=n>opts</span><span class=p>.</span><span class=n>UseHttps</span><span class=p>());</span>
</span></span><span class=line><span class=cl>                <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>这个直接设置 Kestrel 绑定多个地址。尽管它是写死的，但是也可以不是嘛 —— 你可以绑定 <code>IConfiguration</code> 中的地址。当你使用这个办法去设置 kestrel 的绑定的时候，它将会覆盖你用其它办法配置的 <code>URLS</code> 设置，比方说环境变量。当这种情况发生的时候，你可以在日志中看到警告。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>warn: Microsoft.AspNetCore.Server.Kestrel[0]
</span></span><span class=line><span class=cl>      Overriding address(es) &#39;http://localhost:5007&#39;. Binding to endpoints defined in UseKestrel() instead.
</span></span><span class=line><span class=cl>info: Microsoft.Hosting.Lifetime[0]
</span></span><span class=line><span class=cl>      Now listening on: http://127.0.0.1:5002 
</span></span><span class=line><span class=cl>info: Microsoft.Hosting.Lifetime[0]
</span></span><span class=line><span class=cl>      Now listening on: http://[::]:5003
</span></span></code></pre></td></tr></table></div></div><p>个人认为，没有必要像这样从 Kestrel 中绑定端点，但是如果你有需要的话，这是一个摆脱 Kestrel 控制的好方法。</p><h3 id=总结>总结</h3><p>这篇文章中我给出了五种不同的设置监听的 URLs 的办法。<code>UseUrls()</code> 是最简单的，但是并不适合在生产环境中使用。<code>--urls</code> 命令行参数和 <code>ASPNETCORE_</code> / <code>DOTNET_</code> 环境变量是在生产环境中设置最有用的办法。<code>launchSettings.json</code> 文件在开发环境中设置URLs非常有用。如果你需要对配置进行底层的控制，你可以直接使用 Kestrel 的 <code>Listen*</code> 选项，无论是生产环境开始开发环境它们都可以轻易的设置。</p></section><footer class=article-footer><section class=article-tags><a href=/tags/csharp/>CSharp</a>
<a href=/tags/dotnet/>DotNET</a>
<a href=/tags/aspnetcore/>AspNetCore</a>
<a href=/tags/%E7%BC%96%E7%A8%8B/>编程</a>
<a href=/tags/%E7%BF%BB%E8%AF%91/>翻译</a>
<a href=/tags/%E5%90%8E%E7%AB%AF/>后端</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>最后更新于 2025 Jan 13 22:55</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/passages/aspnetcore-docker/><div class=article-details><h2 class=article-title>将 ASP.NET Core 应用程序部署到 docker 中</h2></div></a></article><article><a href=/passages/aspnetcore-webapi-note4-http_method/><div class=article-details><h2 class=article-title>GET、POST都是什么——常用的HTTP方法——ASP.NET Core Web API(4)</h2></div></a></article><article><a href=/passages/aspnetcore-webapi-note3-standard/><div class=article-details><h2 class=article-title>怎么设计优雅的API——普通API对外合约——ASP.NET Core Web API(3)</h2></div></a></article><article><a href=/passages/aspnetcore-webapi-note2-restful/><div class=article-details><h2 class=article-title>什么是 REST——RESTful API 简介——ASP.NET Core Web API(2)</h2></div></a></article><article><a href=/passages/aspnetcore-webapi-note1-start/><div class=article-details><h2 class=article-title>如何创建 ASP.NET Core Web API——准备工作——ASP.NET Core Web API(1)</h2></div></a></article></div></div></aside><script src=//cdn.jsdelivr.net/npm/twikoo@1.6.39/dist/twikoo.all.min.js></script><div id=tcomment></div><style>.twikoo{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}:root[data-scheme=dark]{--twikoo-body-text-color-main:rgba(255, 255, 255, 0.9);--twikoo-body-text-color:rgba(255, 255, 255, 0.7)}.twikoo .el-input-group__prepend,.twikoo .tk-action-icon,.twikoo .tk-submit-action-icon,.twikoo .tk-time,.twikoo .tk-comments-no,.twikoo .tk-comments-count{color:var(--twikoo-body-text-color)}.twikoo .el-input__inner,.twikoo .el-textarea__inner,.twikoo .tk-preview-container,.twikoo .tk-content,.twikoo .tk-nick,.twikoo .tk-send{color:var(--twikoo-body-text-color-main)}.twikoo .el-button{color:var(--twikoo-body-text-color)!important}.twikoo .el-input__count{color:var(--twikoo-body-text-color)!important}.OwO .OwO-body{background-color:var(--body-background)!important;color:var(--body-text-color)!important}</style><script>twikoo.init({envId:"https://api.gaein.cn/comments/",el:"#tcomment",lang:"zh-CN"})</script><footer class=site-footer><section class=copyright>&copy;
2017 -
2025 Gaein nidb 的博客</section><section class=powerby>冀ICP备17015375-1号<br>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>