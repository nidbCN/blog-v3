<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>服务器运维 on Gaein nidb 的博客</title><link>https://blog.gaein.cn/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E7%BB%B4/</link><description>Recent content in 服务器运维 on Gaein nidb 的博客</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Tue, 11 Feb 2025 21:43:00 +0800</lastBuildDate><atom:link href="https://blog.gaein.cn/categories/%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%90%E7%BB%B4/index.xml" rel="self" type="application/rss+xml"/><item><title>将 alpine 系统配置为软路由</title><link>https://blog.gaein.cn/passages/setup-apline-as-router/</link><pubDate>Sun, 06 Oct 2024 21:22:00 +0800</pubDate><guid>https://blog.gaein.cn/passages/setup-apline-as-router/</guid><description>&lt;h3 id="基础工具">基础工具
&lt;/h3>&lt;p>安装：&lt;/p>
&lt;ul>
&lt;li>zsh&lt;/li>
&lt;li>oh-my-zsh&lt;/li>
&lt;li>vim&lt;/li>
&lt;li>7zip&lt;/li>
&lt;li>git&lt;/li>
&lt;li>curl&lt;/li>
&lt;/ul>
&lt;h3 id="发行版配置">发行版配置
&lt;/h3>&lt;p>编辑：&lt;code>/etc/apk/repositories&lt;/code> ，开启社区仓库&lt;/p>
&lt;h3 id="lan-侧配置">LAN 侧配置
&lt;/h3>&lt;h4 id="ip-地址">IP 地址
&lt;/h4>&lt;p>编辑 &lt;code>/etc/network/interfaces&lt;/code>，加入如下内容（以 lan 口为 &lt;code>eth1&lt;/code> 为例）：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">auto eth1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iface eth1 inet static
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> address 172.26.0.1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> netmask 255.255.255.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="dhcp">DHCP
&lt;/h4>&lt;p>DHCP 使用 kea。ISC DHCP 已经在 2022 年宣布停止维护，kea 为其继任者。&lt;/p>
&lt;p>使用 &lt;code>apk add kea&lt;/code> 来安装。&lt;/p>
&lt;p>编辑 &lt;code>/etc/kea/kea-dhcp4.conf&lt;/code>：&lt;/p>
&lt;p>注：以下内容中使用 &lt;code>eth1&lt;/code> &lt;code>172.26.0.1&lt;/code> 作为路由器的 LAN 口网卡和 IP 地址示例，使用 &lt;code>172.26.0.0/24&lt;/code>（子网掩码 &lt;code>255.255.255.0&lt;/code>）作为 LAN 子网，使用 &lt;code>172.26.0.100-172.26.0.200&lt;/code> 作为 DHCP 地址池。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;span class="lnt">178
&lt;/span>&lt;span class="lnt">179
&lt;/span>&lt;span class="lnt">180
&lt;/span>&lt;span class="lnt">181
&lt;/span>&lt;span class="lnt">182
&lt;/span>&lt;span class="lnt">183
&lt;/span>&lt;span class="lnt">184
&lt;/span>&lt;span class="lnt">185
&lt;/span>&lt;span class="lnt">186
&lt;/span>&lt;span class="lnt">187
&lt;/span>&lt;span class="lnt">188
&lt;/span>&lt;span class="lnt">189
&lt;/span>&lt;span class="lnt">190
&lt;/span>&lt;span class="lnt">191
&lt;/span>&lt;span class="lnt">192
&lt;/span>&lt;span class="lnt">193
&lt;/span>&lt;span class="lnt">194
&lt;/span>&lt;span class="lnt">195
&lt;/span>&lt;span class="lnt">196
&lt;/span>&lt;span class="lnt">197
&lt;/span>&lt;span class="lnt">198
&lt;/span>&lt;span class="lnt">199
&lt;/span>&lt;span class="lnt">200
&lt;/span>&lt;span class="lnt">201
&lt;/span>&lt;span class="lnt">202
&lt;/span>&lt;span class="lnt">203
&lt;/span>&lt;span class="lnt">204
&lt;/span>&lt;span class="lnt">205
&lt;/span>&lt;span class="lnt">206
&lt;/span>&lt;span class="lnt">207
&lt;/span>&lt;span class="lnt">208
&lt;/span>&lt;span class="lnt">209
&lt;/span>&lt;span class="lnt">210
&lt;/span>&lt;span class="lnt">211
&lt;/span>&lt;span class="lnt">212
&lt;/span>&lt;span class="lnt">213
&lt;/span>&lt;span class="lnt">214
&lt;/span>&lt;span class="lnt">215
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">diff&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">git&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kea&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dhcp4&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conf&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kea&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dhcp4&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">index&lt;/span> &lt;span class="n">a26ae75&lt;/span>&lt;span class="o">..&lt;/span>&lt;span class="n">e9c578a&lt;/span> &lt;span class="mi">100644&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">---&lt;/span> &lt;span class="n">a&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kea&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dhcp4&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+++&lt;/span> &lt;span class="n">b&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">kea&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">dhcp4&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">conf&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">@@&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">31&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">7&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="mi">31&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">7&lt;/span> &lt;span class="err">@@&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">See&lt;/span> &lt;span class="n">section&lt;/span> &lt;span class="mf">8.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">4&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">more&lt;/span> &lt;span class="n">details&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">You&lt;/span> &lt;span class="n">probably&lt;/span> &lt;span class="n">want&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="n">just&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">interface&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="s2">&amp;#34;eth0&amp;#34;&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="n">specific&lt;/span> &lt;span class="n">IPv4&lt;/span> &lt;span class="n">address&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">that&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">interface&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">g&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="s2">&amp;#34;eth0/192.0.2.1&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;interfaces&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;interfaces&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span> &lt;span class="s2">&amp;#34;eth1&amp;#34;&lt;/span> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">Kea&lt;/span> &lt;span class="n">DHCPv4&lt;/span> &lt;span class="n">server&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">default&lt;/span> &lt;span class="n">listens&lt;/span> &lt;span class="n">using&lt;/span> &lt;span class="n">raw&lt;/span> &lt;span class="n">sockets&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">This&lt;/span> &lt;span class="n">ensures&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">all&lt;/span> &lt;span class="n">packets&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">including&lt;/span> &lt;span class="n">those&lt;/span> &lt;span class="n">sent&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">directly&lt;/span> &lt;span class="n">connected&lt;/span> &lt;span class="n">clients&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">@@&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">149&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">7&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="mi">149&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">7&lt;/span> &lt;span class="err">@@&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">but&lt;/span> &lt;span class="n">it&lt;/span>&lt;span class="s1">&amp;#39;s a lot of writing, so it&amp;#39;&lt;/span>&lt;span class="n">s&lt;/span> &lt;span class="n">easier&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="n">this&lt;/span> &lt;span class="n">instead&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;domain-name-servers&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.1, 192.0.2.2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;119.29.29.29&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">Typically&lt;/span> &lt;span class="n">people&lt;/span> &lt;span class="n">prefer&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">refer&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">options&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">their&lt;/span> &lt;span class="n">names&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">so&lt;/span> &lt;span class="n">they&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">@@&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">159&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">7&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="mi">159&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">7&lt;/span> &lt;span class="err">@@&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;domain-name&amp;#34;&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="s2">&amp;#34;code&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mf">15.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;code&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">15&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;example.org&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;gaein.cn&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">Domain&lt;/span> &lt;span class="n">search&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">also&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">popular&lt;/span> &lt;span class="n">option&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">It&lt;/span> &lt;span class="n">tells&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">client&lt;/span> &lt;span class="n">to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">@@&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">168&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">7&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="mi">168&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">7&lt;/span> &lt;span class="err">@@&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">foo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">mydomain&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">example&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">it&lt;/span> &lt;span class="n">fails&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">then&lt;/span> &lt;span class="n">as&lt;/span> &lt;span class="n">foo&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">example&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">com&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;domain-search&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;mydomain.example.com, example.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;cn-tvs-alpine-homerouter&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="ne">String&lt;/span> &lt;span class="n">options&lt;/span> &lt;span class="n">that&lt;/span> &lt;span class="n">have&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">comma&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">their&lt;/span> &lt;span class="n">values&lt;/span> &lt;span class="n">need&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">have&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">@@&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">217&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">31&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="mi">217&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">6&lt;/span> &lt;span class="err">@@&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">Based&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="n">information&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">can&lt;/span> &lt;span class="n">then&lt;/span> &lt;span class="n">allow&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="n">reject&lt;/span> &lt;span class="n">clients&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">use&lt;/span> &lt;span class="n">certain&lt;/span> &lt;span class="n">subnets&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="n">special&lt;/span> &lt;span class="n">options&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">them&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="n">change&lt;/span> &lt;span class="n">values&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">some&lt;/span> &lt;span class="n">fixed&lt;/span> &lt;span class="n">fields&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;client-classes&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">This&lt;/span> &lt;span class="n">specifies&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">name&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">this&lt;/span> &lt;span class="k">class&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">It&lt;/span>&lt;span class="s1">&amp;#39;s useful if you need to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">reference&lt;/span> &lt;span class="n">this&lt;/span> &lt;span class="k">class&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;voip&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">This&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">test&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">It&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">an&lt;/span> &lt;span class="n">expression&lt;/span> &lt;span class="n">that&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">being&lt;/span> &lt;span class="n">evaluated&lt;/span> &lt;span class="n">on&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">each&lt;/span> &lt;span class="n">incoming&lt;/span> &lt;span class="n">packet&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">It&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">supposed&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">evaluate&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">either&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="bp">true&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="bp">false&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">If&lt;/span> &lt;span class="n">it&lt;/span>&lt;span class="s1">&amp;#39;s true, the packet is added to specified&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="k">class&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">See&lt;/span> &lt;span class="n">Section&lt;/span> &lt;span class="mi">12&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">list&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">available&lt;/span> &lt;span class="n">expressions&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">There&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">several&lt;/span> &lt;span class="n">dozens&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Section&lt;/span> &lt;span class="mf">8.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">14&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">more&lt;/span> &lt;span class="n">details&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">DHCPv4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">classification&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">Section&lt;/span> &lt;span class="mf">9.2&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="mi">19&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">DHCPv6&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;test&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;substring(option[60].hex,0,6) == &amp;#39;Aastra&amp;#39;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">If&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">client&lt;/span> &lt;span class="n">belongs&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">this&lt;/span> &lt;span class="k">class&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">can&lt;/span> &lt;span class="n">define&lt;/span> &lt;span class="n">extra&lt;/span> &lt;span class="n">behavior&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">For&lt;/span> &lt;span class="n">example&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">certain&lt;/span> &lt;span class="n">fields&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">DHCPv4&lt;/span> &lt;span class="n">packet&lt;/span> &lt;span class="n">will&lt;/span> &lt;span class="n">be&lt;/span> &lt;span class="n">set&lt;/span> &lt;span class="n">to&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">certain&lt;/span> &lt;span class="n">values&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;next-server&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.254&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;server-hostname&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;hal9000&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;boot-file-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;/dev/null&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">You&lt;/span> &lt;span class="n">can&lt;/span> &lt;span class="n">also&lt;/span> &lt;span class="n">define&lt;/span> &lt;span class="n">option&lt;/span> &lt;span class="n">values&lt;/span> &lt;span class="n">here&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">want&lt;/span> &lt;span class="n">devices&lt;/span> &lt;span class="n">from&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">this&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">receive&lt;/span> &lt;span class="n">special&lt;/span> &lt;span class="n">options&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">Another&lt;/span> &lt;span class="n">thing&lt;/span> &lt;span class="n">possible&lt;/span> &lt;span class="n">here&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">hooks&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Kea&lt;/span> &lt;span class="n">supports&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">powerful&lt;/span> &lt;span class="n">mechanism&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">that&lt;/span> &lt;span class="n">allows&lt;/span> &lt;span class="n">loading&lt;/span> &lt;span class="n">external&lt;/span> &lt;span class="n">libraries&lt;/span> &lt;span class="n">that&lt;/span> &lt;span class="n">can&lt;/span> &lt;span class="n">extract&lt;/span> &lt;span class="n">information&lt;/span> &lt;span class="ow">and&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">@@&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">294&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">14&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="mi">269&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">14&lt;/span> &lt;span class="err">@@&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">This&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">mandatory&lt;/span> &lt;span class="n">parameter&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">each&lt;/span> &lt;span class="n">subnet&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;subnet&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.0/24&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;subnet&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;172.26.66.0/23&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">Pools&lt;/span> &lt;span class="n">define&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">actual&lt;/span> &lt;span class="n">part&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">your&lt;/span> &lt;span class="n">subnet&lt;/span> &lt;span class="n">that&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">governed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">Kea&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Technically&lt;/span> &lt;span class="n">this&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">optional&lt;/span> &lt;span class="n">parameter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">but&lt;/span> &lt;span class="n">it&lt;/span>&lt;span class="s1">&amp;#39;s&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">almost&lt;/span> &lt;span class="n">always&lt;/span> &lt;span class="n">needed&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">DHCP&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="k">do&lt;/span> &lt;span class="n">its&lt;/span> &lt;span class="n">job&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">If&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">omit&lt;/span> &lt;span class="n">it&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">clients&lt;/span> &lt;span class="n">won&lt;/span>&lt;span class="s1">&amp;#39;t be able to get addresses, unless there are&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">host&lt;/span> &lt;span class="n">reservations&lt;/span> &lt;span class="n">defined&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">them&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;pools&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="s2">&amp;#34;pool&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.1 - 192.0.2.200&amp;#34;&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;pools&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="s2">&amp;#34;pool&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;172.26.67.2 - 172.26.67.100&amp;#34;&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">These&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">options&lt;/span> &lt;span class="n">that&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">subnet&lt;/span> &lt;span class="n">specific&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">In&lt;/span> &lt;span class="n">most&lt;/span> &lt;span class="n">cases&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">need&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">define&lt;/span> &lt;span class="n">at&lt;/span> &lt;span class="n">least&lt;/span> &lt;span class="n">routers&lt;/span> &lt;span class="n">option&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">as&lt;/span> &lt;span class="n">without&lt;/span> &lt;span class="n">this&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">@@&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">312&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">7&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="mi">287&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">7&lt;/span> &lt;span class="err">@@&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">For&lt;/span> &lt;span class="n">each&lt;/span> &lt;span class="n">IPv4&lt;/span> &lt;span class="n">subnet&lt;/span> &lt;span class="n">you&lt;/span> &lt;span class="n">most&lt;/span> &lt;span class="n">likely&lt;/span> &lt;span class="n">need&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">specify&lt;/span> &lt;span class="n">at&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">least&lt;/span> &lt;span class="n">one&lt;/span> &lt;span class="n">router&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;routers&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;172.26.66.1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">@@&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">335&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">31&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="mi">310&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">32&lt;/span> &lt;span class="err">@@&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">It&lt;/span>&lt;span class="s1">&amp;#39;s a rather simple reservation: just an address and nothing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="k">else&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;hw-address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1a:1b:1c:1d:1e:1f&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;ip-address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.201&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;hw-address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;DC:65:55:8A:F6:27&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;ip-address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;172.26.67.1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;hostname&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;h3c-ap&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">This&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">reservation&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">specific&lt;/span> &lt;span class="n">client&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">It&lt;/span> &lt;span class="n">also&lt;/span> &lt;span class="n">shows&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">this&lt;/span> &lt;span class="n">client&lt;/span> &lt;span class="n">will&lt;/span> &lt;span class="n">get&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">reserved&lt;/span> &lt;span class="n">hostname&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">A&lt;/span> &lt;span class="n">hostname&lt;/span> &lt;span class="n">can&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">be&lt;/span> &lt;span class="n">defined&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">any&lt;/span> &lt;span class="n">identifier&lt;/span> &lt;span class="n">type&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">just&lt;/span> &lt;span class="n">client&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;client-id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;01:11:22:33:44:55:66&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;ip-address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.202&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;hostname&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;special-snowflake&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;client-id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;01:11:22:33:44:55:66&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;ip-address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.202&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;hostname&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;special-snowflake&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">The&lt;/span> &lt;span class="n">third&lt;/span> &lt;span class="n">reservation&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">based&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">DUID&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">This&lt;/span> &lt;span class="n">reservation&lt;/span> &lt;span class="n">defines&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">special&lt;/span> &lt;span class="n">option&lt;/span> &lt;span class="n">values&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">this&lt;/span> &lt;span class="n">particular&lt;/span> &lt;span class="n">client&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">If&lt;/span> &lt;span class="n">the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">domain&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">servers&lt;/span> &lt;span class="n">option&lt;/span> &lt;span class="n">would&lt;/span> &lt;span class="n">have&lt;/span> &lt;span class="n">been&lt;/span> &lt;span class="n">defined&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">global&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">subnet&lt;/span> &lt;span class="ow">or&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="n">level&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">host&lt;/span> &lt;span class="n">specific&lt;/span> &lt;span class="n">values&lt;/span> &lt;span class="n">take&lt;/span> &lt;span class="n">preference&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;duid&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;01:02:03:04:05&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;ip-address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.203&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;option-data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;domain-name-servers&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.1.1.202, 10.1.1.203&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;duid&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;01:02:03:04:05&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;ip-address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.203&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;option-data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;domain-name-servers&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.1.1.202, 10.1.1.203&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="p">}&lt;/span> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">The&lt;/span> &lt;span class="n">fourth&lt;/span> &lt;span class="n">reservation&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">based&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">circuit&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">id&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">This&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">an&lt;/span> &lt;span class="n">option&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">inserted&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">relay&lt;/span> &lt;span class="n">agent&lt;/span> &lt;span class="n">that&lt;/span> &lt;span class="n">forwards&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">packet&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">client&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">@@&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">370&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">31&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="mi">346&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">31&lt;/span> &lt;span class="err">@@&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">reservations&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">global&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">reservations&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="ow">in&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">subnet&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">reservations&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">out&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">of&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">pool&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">subnet&lt;/span> &lt;span class="n">specific&lt;/span> &lt;span class="n">parameters&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">host&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">reservation&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">identifiers&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">global&lt;/span> &lt;span class="n">parameter&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;client-id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;01:12:23:34:45:56:67&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;ip-address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.204&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;option-data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;vivso-suboptions&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;4491&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;tftp-servers&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;space&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;vendor-4491&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.1.1.202, 10.1.1.203&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;client-id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;01:12:23:34:45:56:67&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;ip-address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.204&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;option-data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;vivso-suboptions&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;4491&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;tftp-servers&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;space&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;vendor-4491&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;data&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;10.1.1.202, 10.1.1.203&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">This&lt;/span> &lt;span class="n">reservation&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">a&lt;/span> &lt;span class="n">client&lt;/span> &lt;span class="n">that&lt;/span> &lt;span class="n">needs&lt;/span> &lt;span class="n">specific&lt;/span> &lt;span class="n">DHCPv4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">fields&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">be&lt;/span> &lt;span class="n">set&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Three&lt;/span> &lt;span class="n">supported&lt;/span> &lt;span class="n">fields&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">next&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">server&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">hostname&lt;/span> &lt;span class="ow">and&lt;/span> &lt;span class="n">boot&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;client-id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;01:0a:0b:0c:0d:0e:0f&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;ip-address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.205&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;next-server&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;server-hostname&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;hal9000&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;boot-file-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;/dev/null&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;client-id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;01:0a:0b:0c:0d:0e:0f&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;ip-address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.205&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;next-server&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;server-hostname&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;hal9000&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;boot-file-name&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;/dev/null&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">This&lt;/span> &lt;span class="n">reservation&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">using&lt;/span> &lt;span class="n">flexible&lt;/span> &lt;span class="n">identifier&lt;/span>&lt;span class="o">.&lt;/span> &lt;span class="n">Instead&lt;/span> &lt;span class="n">of&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">relying&lt;/span> &lt;span class="n">on&lt;/span> &lt;span class="n">specific&lt;/span> &lt;span class="n">field&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sysadmin&lt;/span> &lt;span class="n">can&lt;/span> &lt;span class="n">define&lt;/span> &lt;span class="n">an&lt;/span> &lt;span class="n">expression&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">similar&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">what&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">used&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">client&lt;/span> &lt;span class="n">classification&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">@@&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">405&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">10&lt;/span> &lt;span class="o">+&lt;/span>&lt;span class="mi">381&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">10&lt;/span> &lt;span class="err">@@&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">Note&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">flexible&lt;/span> &lt;span class="n">identifier&lt;/span> &lt;span class="n">requires&lt;/span> &lt;span class="n">flex_id&lt;/span> &lt;span class="n">hook&lt;/span> &lt;span class="n">library&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">be&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">loaded&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">work&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;flex-id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#39;s0mEVaLue&amp;#39;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="s2">&amp;#34;ip-address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.206&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">-&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;flex-id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#39;s0mEVaLue&amp;#39;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="s2">&amp;#34;ip-address&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;192.0.2.206&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">+&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">You&lt;/span> &lt;span class="n">can&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="n">more&lt;/span> &lt;span class="n">reservations&lt;/span> &lt;span class="n">here&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">You&lt;/span> &lt;span class="n">can&lt;/span> &lt;span class="n">add&lt;/span> &lt;span class="n">more&lt;/span> &lt;span class="n">subnets&lt;/span> &lt;span class="n">there&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="dns">DNS
&lt;/h4>&lt;p>待补充&lt;/p>
&lt;h3 id="wan-侧配置">WAN 侧配置
&lt;/h3>&lt;h4 id="ip-地址以及上网方式">IP 地址以及上网方式
&lt;/h4>&lt;h5 id="使用-dhcp">使用 DHCP
&lt;/h5>&lt;p>编辑 &lt;code>/etc/network/interfaces&lt;/code>，加入如下内容（以 wan 口为 &lt;code>eth0&lt;/code> 为例）：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">auto eth0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iface eth0 inet dhcp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="使用-pppoe">使用 PPPoE
&lt;/h5>&lt;p>使用 &lt;code>apk add ppp-pppoe&lt;/code> 安装包。&lt;/p>
&lt;p>编辑 &lt;code>/etc/ppp/peers/isp&lt;/code>，写入如下内容：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">noipdefault
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">defaultroute
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">replacedefaultroute
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">hide-password
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#lcp-echo-interval 30
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#lcp-echo-failure 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">noauth
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">persist
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#mtu 1492
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#maxfail 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#holdoff 20
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">plugin pppoe.so eth0 # WAN 侧网卡
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">user &amp;#34;ip1**********&amp;#34; # PPPoE 用户名
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">#usepeerdns # 使用运营商 DNS
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>编辑 &lt;code>/etc/ppp/chap-secrets&lt;/code>，写入以下内容：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># &amp;lt;PPPoE 用户名&amp;gt; &amp;lt;服务器&amp;gt; &amp;lt;PPPoE 密码&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;ip1**********&amp;#34; * &amp;#34;********&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>编辑完后可使用 &lt;code>pon isp&lt;/code> 和 &lt;code>poff&lt;/code> 来连接和断开 PPPoE。&lt;/p>
&lt;p>如果需要自动建立连接，使用 &lt;code>apk add ifupdown-ng-ppp&lt;/code> 添加包，并编写 &lt;code>/etc/network/interfaces&lt;/code> 后加入如下内容：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">auto ppp0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iface ppp0 inet ppp
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> provider isp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>本小节中 &lt;code>isp&lt;/code> 为 &lt;code>/etc/ppp/peers/&lt;/code> 下的文件名，可以自行更改。&lt;/p>
&lt;p>&lt;strong>注意：&lt;/strong> 由于 PPPoE 是将 PPP 协议 “抬旗” 到了 “二层之上、三层之下” 的位置，因此，原本 1500 Mtu 的 Ethernet 内又塞了 PPP，其协议占据了 8 字节，因此对于三层协议来说，Mtu 由 1500 降低到了 1492（典型情况）。此时，由 lan 传入的（Mtu 1500）的超过 PPPoE 网卡的 Mtu 包将无法正常发送，造成 “能 ping 通、能解析却不能打开部分网页” 的现象。**具体解决方案参考防火墙配置中的 PPPoE 小节。**顺便一提，这一做法在 openwrt 的界面中对应的是 “MSS 钳制”。&lt;/p>
&lt;h3 id="nat防护墙等中间处理配置">NAT、防护墙等中间处理配置
&lt;/h3>&lt;h4 id="sysctl">sysctl
&lt;/h4>&lt;p>开启内核相关参数&lt;/p>
&lt;h5 id="bbr">BBR
&lt;/h5>&lt;p>输入 &lt;code>modprobe tcp_bbr&lt;/code> ，该命令无输出&lt;/p>
&lt;p>编辑 &lt;code>/etc/sysctl.d/90-tcp-bbr.conf&lt;/code>，写入如下内容：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">net.core.default_qdisc=fq_codel
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">net.ipv4.tcp_congestion_control=bbr
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h5 id="ip-forward">IP Forward
&lt;/h5>&lt;p>编辑 &lt;code>/etc/sysctl.d/90-IPv4-forwarding.conf&lt;/code>，写入如下内容：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">net.ipv4.ip_forward=1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>完成后使用 &lt;code>sysctl -p&lt;/code> 生效。&lt;/p>
&lt;h4 id="防火墙nat">防火墙&amp;amp;NAT
&lt;/h4>&lt;p>使用 &lt;code>apk add nftables&lt;/code> 安装防火墙。&lt;/p>
&lt;p>编辑 &lt;code>/etc/nftables.d/90-nat.nft&lt;/code>，写入如下内容：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#!/usr/sbin/nft -f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">table inet nat {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> chain prerouting {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type nat hook prerouting priority dstnat; policy accept;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> chain postrouting {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type nat hook postrouting priority srcnat; policy accept;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> oifname &amp;#34;ppp0&amp;#34; masquerade
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>编辑 &lt;code>/etc/nftables.d/90-filter.nft&lt;/code>，写入如下内容：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">#!/usr/sbin/nft -f
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">table inet filter {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> chain input {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> iifname &amp;#34;eth1&amp;#34; accept
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> chain forward {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type filter hook forward priority filter; policy accept;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> tcp flags syn tcp option maxseg size set rt mtu
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> chain output {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> type filter hook output priority filter; policy accept;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>其他的如 ICMP 等内容在 &lt;code>/etc/nftables.nft&lt;/code> 中已经默认配好，如果喜欢可以移至此文件方便管理。&lt;/p>
&lt;h5 id="pppoe-或两侧-mtu-不同">PPPoE 或两侧 Mtu 不同
&lt;/h5>&lt;p>编辑 &lt;code>/etc/nftables.d/90-filter.nft&lt;/code>，在 &lt;code>chain forward&lt;/code> 中加入如下内容：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">tcp flags syn tcp option maxseg size set rt mtu
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>当然，你可能发现了，这一条是对 tcp 协议设置的，不仅需要解协议而且不对其他协议生效。可以将两个网卡的 MTU 设置为相同值，只会在内网损失少量的利用率。&lt;/p>
&lt;h4 id="全锥形-nat">全锥形 NAT
&lt;/h4>&lt;p>参考：&lt;a class="link" href="https://github.com/Chion82/netfilter-full-cone-nat" target="_blank" rel="noopener"
>Chion82/netfilter-full-cone-nat: A kernel module to turn MASQUERADE into full cone SNAT&lt;/a>&lt;/p>
&lt;h4 id="其它软件">其它软件
&lt;/h4>&lt;p>这里使用：daeuniverse/dae&lt;/p>
&lt;h5 id="系统要求">系统要求
&lt;/h5>&lt;p>&lt;code>uname -r&lt;/code> 确保大于 &lt;code>5.8&lt;/code>&lt;/p>
&lt;p>执行：&lt;code>(zcat /proc/config.gz || cat /boot/config-virt) | grep -E 'CONFIG_(DEBUG_INFO|DEBUG_INFO_BTF|KPROBES|KPROBE_EVENTS|BPF|BPF_SYSCALL|BPF_JIT|BPF_STREAM_PARSER|NET_CLS_ACT|NET_SCH_INGRESS|NET_INGRESS|NET_EGRESS|NET_CLS_BPF|BPF_EVENTS|CGROUPS)=|# CONFIG_DEBUG_INFO_REDUCED is not set'&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">CONFIG_BPF=y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG_BPF_SYSCALL=y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG_BPF_JIT=y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG_CGROUPS=y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG_KPROBES=y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG_NET_INGRESS=y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG_NET_EGRESS=y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG_NET_SCH_INGRESS=m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG_NET_CLS_BPF=m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG_NET_CLS_ACT=y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG_BPF_STREAM_PARSER=y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG_DEBUG_INFO=y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># CONFIG_DEBUG_INFO_REDUCED is not set
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG_DEBUG_INFO_BTF=y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG_KPROBE_EVENTS=y
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONFIG_BPF_EVENTS=y
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>我使用的 alpine-3.19 满足&lt;/p>
&lt;p>参考：&lt;a class="link" href="https://github.com/daeuniverse/dae/blob/main/docs/en/tutorials/run-on-alpine.md" target="_blank" rel="noopener"
>Run on Alpine Linux&lt;/a>&lt;/p>
&lt;p>&lt;code>/etc/rc.conf&lt;/code> &lt;code>rc_cgroup_mode=&amp;quot;unified&amp;quot;&lt;/code>&lt;/p>
&lt;p>&lt;code>rc-update add cgroups boot&lt;/code>&lt;/p>
&lt;p>&lt;code>/etc/init.d/sysfs #mount_misc&lt;/code>&lt;/p>
&lt;h5 id="安装">安装
&lt;/h5>&lt;p>&lt;code>wget https://github.com/daeuniverse/dae-installer/raw/main/installer.sh&lt;/code>&lt;/p>
&lt;p>&lt;code>chmod +x installer.sh&lt;/code>&lt;/p>
&lt;p>&lt;code>mkdir /etc/dae&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># load all dae files placed in ./config.d/
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">include&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="cm">/*.dae
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">global {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> ##### Software options.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # tproxy port to listen on. It is NOT a HTTP/SOCKS port, and is just used by eBPF program.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # In normal case, you do not need to use it.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> tproxy_port: 12345
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # Set it true to protect tproxy port from unsolicited traffic. Set it false to allow users to use self-managed
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # iptables tproxy rules.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> tproxy_port_protect: true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # Set non-zero value to enable pprof.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> pprof_port: 0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # If not zero, traffic sent from dae will be set SO_MARK. It is useful to avoid traffic loop with iptables tproxy
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # rules.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> so_mark_from_dae: 0
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # Log level: error, warn, info, debug, trace.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> log_level: info
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # Disable waiting for network before pulling subscriptions.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> disable_waiting_network: false
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # Enable fast redirect for local TCP connections. There is a known kernel issue that breaks certain clients/proxies, such as nadoo/glider. Users may enable this experimental option at their own risks.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> enable_local_tcp_fast_redirect: false
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> ##### Interface and kernel options.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # The LAN interface to bind. Use it if you want to proxy LAN.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # Multiple interfaces split by &amp;#34;,&amp;#34;.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> lan_interface: eth1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # The WAN interface to bind. Use it if you want to proxy localhost.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # Multiple interfaces split by &amp;#34;,&amp;#34;. Use &amp;#34;auto&amp;#34; to auto detect.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> wan_interface: auto
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # Automatically configure Linux kernel parameters like ip_forward and send_redirects. Check out
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # https://github.com/daeuniverse/dae/blob/main/docs/en/user-guide/kernel-parameters.md to see what will dae do.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> auto_config_kernel_parameter: true
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> ##### Node connectivity check.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # Host of URL should have both IPv4 and IPv6 if you have double stack in local.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # First is URL, others are IP addresses if given.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # Considering traffic consumption, it is recommended to choose a site with anycast IP and less response.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> #tcp_check_url: &amp;#39;http://cp.cloudflare.com&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> tcp_check_url: &amp;#39;http://cp.cloudflare.com,1.1.1.1,2606:4700:4700::1111&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # The HTTP request method to `tcp_check_url`. Use &amp;#39;HEAD&amp;#39; by default because some server implementations bypass
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # accounting for this kind of traffic.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> tcp_check_http_method: HEAD
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # This DNS will be used to check UDP connectivity of nodes. And if dns_upstream below contains tcp, it also be used to check
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # TCP DNS connectivity of nodes.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # First is URL, others are IP addresses if given.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # This DNS should have both IPv4 and IPv6 if you have double stack in local.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> #udp_check_dns: &amp;#39;dns.google.com:53&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> udp_check_dns: &amp;#39;dns.google.com:53,8.8.8.8,2001:4860:4860::8888&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> check_interval: 120s
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # G/oup will switch node only when new_latency &amp;lt;= old_latency - tolerance.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> check_tolerance: 50ms
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> ##### Connecting options.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # Optional values of dial_mode are:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # 1. &amp;#34;ip&amp;#34;. Dial proxy using the IP from DNS directly. This allows your ipv4, ipv6 to choose the optimal path
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # respectively, and makes the IP version requested by the application meet expectations. For example, if you
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # use curl -4 ip.sb, you will request IPv4 via proxy and get a IPv4 echo. And curl -6 ip.sb will request IPv6.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # This may solve some wierd full-cone problem if your are be your node support that. Sniffing will be disabled
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # in this mode.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # 2. &amp;#34;domain&amp;#34;. Dial proxy using the domain from sniffing. This will relieve DNS pollution problem to a great extent
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # if have impure DNS environment. Generally, this mode brings faster proxy response time because proxy will
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # re-resolve the domain in remote, thus get better IP result to connect. This policy does not impact routing.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # That is to say, domain rewrite will be after traffic split of routing and dae will not re-route it.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # 3. &amp;#34;domain+&amp;#34;. Based on domain mode but do not check the reality of sniffed domain. It is useful for users whose
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # DNS requests do not go through dae but want faster proxy response time. Notice that, if DNS requests do not
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # go through dae, dae cannot split traffic by domain.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # 4. &amp;#34;domain++&amp;#34;. Based on domain+ mode but force to re-route traffic using sniffed domain to partially recover
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # domain based traffic split ability. It doesn&amp;#39;t work for direct traffic and consumes more CPU resources.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> dial_mode: domain+
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # Timeout to waiting for first data sending for sniffing. It is always 0 if dial_mode is ip. Set it higher is useful
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # in high latency LAN network.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> sniffing_timeout: 100ms
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # TLS implementation. tls is to use Go&amp;#39;s crypto/tls. utls is to use uTLS, which can imitate browser&amp;#39;s Client Hello.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> tls_implementation: tls
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # The Client Hello ID for uTLS to imitate. This takes effect only if tls_implementation is utls.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> # See more: https://github.com/daeuniverse/dae/blob/331fa23c16/component/outbound/transport/tls/utls.go#L17
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> utls_imitate: chrome_auto
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"># dns sniff see: /etc/dae/config.d/dns.dae
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"># node and group: see /etc/dae/config.d/nodes.dae
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"># routing: see /etc/dae/config.d/route.dae
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>直播推流常见协议及网页端实现 RTMP/STR/FLV/HLS/WebRTC</title><link>https://blog.gaein.cn/passages/live-streaming-protocols/</link><pubDate>Tue, 11 Jul 2023 19:05:15 +0800</pubDate><guid>https://blog.gaein.cn/passages/live-streaming-protocols/</guid><description>&lt;img src="https://img.cdn.gaein.cn/website_used/blog/Live-streaming-protocols/cover.webp" alt="Featured image of post 直播推流常见协议及网页端实现 RTMP/STR/FLV/HLS/WebRTC" />&lt;h2 id="前言">前言
&lt;/h2>&lt;p>最近一个月在叔叔那直播动画，但是被封了。寻思自己随便找个服务器播着玩，搭了个开源的又对延迟什么的不满意，于是走上了折腾这一车直播协议的&lt;del>不归路。&lt;/del>&lt;/p>
&lt;h2 id="前置编码编码器格式与容器">前置：编码、编码器、格式与容器？
&lt;/h2>&lt;blockquote>
&lt;p>心里不是特别有底，可能有部分地方有疏漏或错误之处，还请谅解。&lt;/p>&lt;/blockquote>
&lt;h3 id="编码encode解码decode">编码(encode)/解码(decode)
&lt;/h3>&lt;p>我们说到多媒体时候，经常说什么 &lt;code>mp4&lt;/code> 辣，&lt;code>avi&lt;/code> 辣，同时又经常听到什么 &lt;code>H.265&lt;/code>、&lt;code>H.264&lt;/code> 这种“奇怪”的词。&lt;/p>
&lt;p>编码代表了如何去将视频变成二进制，解码代表了将编码出来的二进制在变成视频。&lt;/p>
&lt;p>为什么要编码呢？以一个 YUV 4:2:2 像素格式的 1080p 60FPS 视频为例，每秒的大小为 &lt;code>1920*1080*2*60=237Mb&lt;/code> ，一个俩小时的电影就是小俩TB&amp;hellip; 这显然是不可接受的。编码在方便视频存储的同时根据相邻的帧相似的地方等进行压缩。&lt;/p>
&lt;p>&lt;del>什么？你说怎么实现？他很厉害，他不是一个有形的。所以你读《心经》，《心经》里面讲什么&amp;hellip;&lt;/del>&lt;/p>
&lt;h3 id="编encoder解decoder码器codec">编(encoder)解(decoder)码器(codec)
&lt;/h3>&lt;p>此前说的编码是一种规范或者说算法，比如说 &lt;code>H.264&lt;/code> 编码，要先这样再那样再那样，诶就好了。&lt;/p>
&lt;p>编解码器(codec)就是具体干这个的。&lt;/p>
&lt;p>比如 &lt;code>H.264&lt;/code> 编码常见的编解码器有 &lt;code>libx264&lt;/code>、&lt;code>nvenc&lt;/code> 等等。&lt;/p>
&lt;p>如果你使用 &lt;code>ffmpeg&lt;/code> 的话，不妨输入 &lt;code>ffmpeg -codecs&lt;/code> 来看看 &lt;code>ffmpeg&lt;/code> 支持的那些编解码和器。&lt;/p>
&lt;h3 id="格式format">格式(format)
&lt;/h3>&lt;p>现在编码器已经可以根据编码把视频变成一大堆二进制了，如何存储他们？&lt;/p>
&lt;p>显然，直接将这一坨二进制写入磁盘不太合理，这样的话谁知道他用的什么编码，该如何解码？另外一个多媒体文件还可能会有音频，怎么区分开这一坨二进制里面的视频和音频？字幕怎么办？分章节的怎么办？&lt;/p>
&lt;p>显然，问题太多了，所以才有了格式，以比较简单的 avi 为例：&lt;/p>
&lt;p>avi 嘛，全称是音频视频交错格式，这玩意就是一截音频，一截视频，一截音频，一截视频&amp;hellip;&lt;/p>
&lt;p>而 flv 是一个 header（标识有下面的内容有多少个字节之类），然后是一个tag，一个二进制，一个tag，一个二进制&amp;hellip;这种能够读一点、放一点的格式就很利好直播（毕竟有些格式二进制堆在一起，你放个电影得全下完才能播）&lt;/p>
&lt;blockquote>
&lt;p>注意，以上举例经过简化，实际格式比起文章内缩写复杂。这样写方便大家理解，如果需要了解这些格式的细节请自行查阅资料。&lt;/p>&lt;/blockquote>
&lt;h3 id="容器container">容器(container)
&lt;/h3>&lt;p>很多时候“容器”与“格式”用的一个名字，比如 &lt;code>flv&lt;/code>、&lt;code>mp4&lt;/code> 等，容器便是你能看到的文件。容器可能会支持多种格式，比如著名的 &lt;code>Matroska&lt;/code> ，支持几乎所有常见的格式。容器内除了多媒体内容外，还有一些 metadata（章节信息、标题等）。&lt;/p>
&lt;h2 id="都有那些直播用协议">都有那些直播用协议？
&lt;/h2>&lt;h3 id="经典推拉流协议rtmprtsp">经典推拉流协议：RTMP/RTSP
&lt;/h3>&lt;p>对于如何做直播流这件事，最简单也是最好办的方法就是——&lt;/p>
&lt;h4 id="rtmp">RTMP
&lt;/h4>&lt;p>RTMP 全名为 &lt;code>Real Time Messaging Protocol&lt;/code>，开发后被 Adobe 收购。&lt;/p>
&lt;p>目前在各种领域应用广泛，几乎所有的直播平台都支持 RTMP 协议推流。&lt;/p>
&lt;p>RTMP 采用 TCP 连接，优点是稳定、延迟低。&lt;/p>
&lt;p>RTMP 采用经典广泛的 H.264 和 AAC，格式为 flv。&lt;/p>
&lt;p>缺点也很简单：现代浏览器不能使用 RTMP 拉流。也就是说浏览器不能直接播放 RTMP 直播流。&lt;/p>
&lt;p>目前通常只使用 RTMP 推流，各种直播客户端&amp;amp;APP可以使用 RTMP 拉流播放。&lt;/p>
&lt;h4 id="rtsp">RTSP
&lt;/h4>&lt;p>RTSP 虽然名字和 RTMP 很像，但并不是一家的。RTSP 的特点是：使用 TCP 发送控制请求、使用 UDP 传输媒体数据。其使用 RTP 协议分视频块传输。&lt;/p>
&lt;p>有点是嘎嘎低延迟，但是在 Android 和 iOS 上似乎没有开箱即用的库。&lt;/p>
&lt;p>广泛应用于监控领域。&lt;/p>
&lt;h3 id="基于http的拉流协议http-flvhlsmpeg-dash">基于HTTP的拉流协议：HTTP-Flv/HLS/MPEG-DASH
&lt;/h3>&lt;p>由于现代浏览器并没有直接办法发起 TCP 请求等（以前 RTMP 使用类似于 Java 浏览器插件等方式工作，但是由于安全原因现代浏览器并不支持这么干），所以需要将 RTMP 直播流进行简单的处理，将其变成浏览器能拿到的。&lt;/p>
&lt;h4 id="http-flv">HTTP-Flv
&lt;/h4>&lt;p>前文介绍过 Flv，它文件体内除了头，存储媒体信息的是一小段、一小段的，也就是说你不需要下载整个文件，就可以解码出其中的、你已经获取到的音视频。这种特性使得 flv 非常适合做直播。&lt;/p>
&lt;p>并且，由于以前 flash 插件的高流行度，使得使用 HTTP 获取 flv 文件边获取边播放的方式更加流行了。&lt;/p>
&lt;p>HTTP-Flv 相比较与其它方法来说延迟不高，但是缺点是——&lt;strong>现代浏览器不支持 flash player 辣！&lt;/strong>&lt;/p>
&lt;p>噔噔咚，然后你就不能放 &lt;code>flv&lt;/code> 了。HTML5 原生支持的只有 &lt;code>webm&lt;/code> 和 &lt;code>mp4&lt;/code> 等。&lt;/p>
&lt;p>解决办法总是有的嘛，还记得在 flash player 停止支持前 bilibili 的 &lt;code>HTML5 播放器&lt;/code> 吗？没错，叔叔给他开源出来了，而且协议是 Apache-2.0。&lt;/p>
&lt;h5 id="叔叔怎么解-flv-的">叔叔怎么解 flv 的？
&lt;/h5>&lt;p>既然浏览器不支持 flv，那么叔叔怎么做的 &lt;code>flv.js&lt;/code> 呢？难道是摁写 &lt;code>js&lt;/code> 或者用 &lt;code>wasm&lt;/code> 解析 flv 然后解码然后在浏览器上画？&lt;/p>
&lt;p>当然不是。有一个神奇的东西叫做 &lt;code>MSE&lt;/code> ，&lt;code>video&lt;/code> 标签不是只支持 &lt;code>mp4&lt;/code> 吗？那我把 &lt;code>flv&lt;/code> 变成小 &lt;code>mp4&lt;/code> 总行了吧！Media Source Extension 支持在代码中构建 &lt;code>MediaSource&lt;/code> 对象并将其作为 &lt;code>src&lt;/code> 传递给 &lt;code>video&lt;/code> 标签。&lt;/p>
&lt;p>简而言之，你只需要把东西变成 &lt;code>mp4&lt;/code> 格式，不需要自己解码，然后交给浏览器就好了！&lt;/p>
&lt;p>当然，对于 &lt;code>h.265/HEVC&lt;/code> 这种浏览器不支持的，叔叔那真就拿 &lt;code>wasm&lt;/code> 开了一堆线程搁用户浏览器上软解，前阵子骂的沸沸扬扬的。&lt;/p>
&lt;p>flv.js 项目对于该实现的原文：&lt;/p>
&lt;blockquote>
&lt;p>flv.js works by transmuxing FLV file stream into ISO BMFF (Fragmented MP4) segments, followed by feeding mp4 segments into an HTML5 &lt;video> element through Media Source Extensions API.&lt;/p>&lt;/blockquote>
&lt;p>于是，有了叔叔的帮助，我们就可以在浏览器播放 flv 了，当然也可以看直播了。&lt;/p>
&lt;p>另外，注意 flv.js 项目首页上写道的：&lt;/p>
&lt;blockquote>
&lt;p>For FLV live stream playback, please consider mpegts.js which is under active development.&lt;/p>
&lt;p>This project will become rarely maintained.&lt;/p>&lt;/blockquote>
&lt;p>推荐我们使用 &lt;code>mpegts.js&lt;/code> 来播放直播流，该项目开发者也是 &lt;code>flv.js&lt;/code> 开发者之一，其对直播进行了优化。&lt;/p>
&lt;h4 id="hls">HLS
&lt;/h4>&lt;p>HLS 全程是 &lt;code>HTTP Live Stream&lt;/code> ，是水果公司整的。&lt;/p>
&lt;p>其具体工作原理是先获取一个列表文件，然后挨个请求里面的 &lt;code>ts&lt;/code> 文件挨个播放。&lt;/p>
&lt;p>目前来说 HLS 支持在 IOS、Safari 及安卓上最新版本的浏览器/Chrome 浏览器。通过 js 也可以在其它现代浏览器上播放。&lt;/p>
&lt;p>目前可以播放 HLS 的 JS 播放器有：&lt;/p>
&lt;ol>
&lt;li>&lt;a class="link" href="https://github.com/video-dev/hls.js" target="_blank" rel="noopener"
>hls.js&lt;/a>&lt;/li>
&lt;/ol>
&lt;h4 id="mpeg-dash">MPEG-DASH
&lt;/h4>&lt;p>DASH 的意思是 “基于 HTTP 的动态自适应流”，DASH 技术很新，设计的很棒，其原理也是 XHR 请求视频数据块，再添加入 &lt;code>video&lt;/code> 标签。&lt;/p>
&lt;p>不过据 SRS Github issue 说，DASH 的设计很棒有点“想得很美”的意思，似乎协议写的不是特别清除，实现的有些迷糊。&lt;/p>
&lt;p>目前可以播放 MPEG-DASH 的播放器有：&lt;/p>
&lt;ol>
&lt;li>&lt;a class="link" href="https://github.com/Dash-Industry-Forum/dash.js" target="_blank" rel="noopener"
>dash.js&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/shaka-project/shaka-player" target="_blank" rel="noopener"
>shaka-player&lt;/a>&lt;/li>
&lt;/ol>
&lt;h3 id="新技术webrtc与srt">新技术：WebRTC与SRT
&lt;/h3>&lt;p>除了以上几种经典方案外，近年来出现了 WebRTC 和 SRT 协议。&lt;/p>
&lt;h4 id="webrtc">WebRTC
&lt;/h4>&lt;p>WebRTC 是一项实时通讯技术，建立点对点连接并实现任意数据传输。适用于浏览器的摄像头直播会议等场景。&lt;/p>
&lt;p>WebRTC 算是一种较新的技术。目前看来其前景广阔。但是经过测试不知道是 SRS 问题抑或是 WebRTC 问题，推流直播效果不够好。&lt;/p>
&lt;h4 id="srt">SRT
&lt;/h4>&lt;p>SRT 为了解决 RTMP 的问题（旧、延迟高等），开发出了基于UDT（UDP的传输协议）的新协议。&lt;/p>
&lt;p>特点是快速连接以及按照时间发送音视频数据等。&lt;/p>
&lt;p>小缺点是 URL 不太容易看懂，另外就是其拥塞控制有些简单。&lt;/p>
&lt;h2 id="使用-srs-接收-rtmpsrt-推流">使用 SRS 接收 RTMP/SRT 推流
&lt;/h2>&lt;h3 id="推流工具">推流工具
&lt;/h3>&lt;p>在b站直播，我们可以使用b站直播只因等工具。当然，大家也注意到了，有很多up主或者其它平台在使用 OBS Studio 这款软件。&lt;/p>
&lt;h4 id="obs-studio">OBS Studio
&lt;/h4>&lt;p>&lt;a class="link" href="https://obsproject.com/" target="_blank" rel="noopener"
>Open Broadcaster Software | OBS&lt;/a>&lt;/p>
&lt;p>OBS Studio 更合适一般在电脑上的直播（比如各种游戏直播），可以实时看到反馈，使用方便。&lt;/p>
&lt;h4 id="ffmpeg">ffmpeg
&lt;/h4>&lt;p>在无GUI环境下，更适合用 ffmpeg 进行推流。&lt;/p>
&lt;p>ffmpeg 适合无人值守直播（比如7x24的动画片之类），易于编程和调用，性能要求低。&lt;/p>
&lt;h2 id="浏览器端实现拉流播放-http-flvhlsdash">浏览器端实现拉流播放 HTTP-FLV/HLS/DASH
&lt;/h2>&lt;h3 id="dplayer">DPlayer
&lt;/h3>&lt;p>Dplayer 是 DIYGOD 开发的播放器。支持多种媒体，且可以通过自定义 type 来支持其它 MSE 播放器来实现各种协议的视频播放。为了风格统一，使用了该播放器来做直播播放。&lt;/p>
&lt;h3 id="编码实现">编码实现
&lt;/h3>&lt;p>首先先在 vue 上初始化 Dplayer 播放器：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-vue" data-lang="vue">&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">ref&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;playerContainer&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">script&lt;/span> &lt;span class="na">setup&lt;/span> &lt;span class="na">lang&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;ts&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">computed&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">onMounted&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">onUpdated&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ref&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s2">&amp;#34;vue&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">createVideo&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s2">&amp;#34;@/utils/videoEngine&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">DPlayer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">DPlayerDanmaku&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s2">&amp;#34;dplayer&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">options&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="nx">from&lt;/span> &lt;span class="s2">&amp;#34;@/utils/request&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">props&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">defineProps&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">streamName&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">string&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">player&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">ref&lt;/span>&lt;span class="p">({}&lt;/span> &lt;span class="nx">as&lt;/span> &lt;span class="nx">DPlayer&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">srsAddress&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">ref&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">serverAddress&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">playerContainer&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">ref&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">videoItem&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">computed&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">createVideo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">liveType&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">liveType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">flvJs&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">srsAddress&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">value&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">streamName&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nx">onMounted&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">DPlayer&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">container&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">playerContainer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">value&lt;/span> &lt;span class="nx">as&lt;/span> &lt;span class="nx">HTMLElement&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">live&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">autoplay&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">theme&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;#F19EC2&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">video&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">videoItem&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">value&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">value&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">play&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 当源地址值更新时，切换视频。
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="nx">onUpdated&lt;/span>&lt;span class="p">(()&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">value&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">pause&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">value&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">switchVideo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">videoItem&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">value&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{}&lt;/span> &lt;span class="nx">as&lt;/span> &lt;span class="nx">DPlayerDanmaku&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">value&lt;/span>&lt;span class="o">?&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">play&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">script&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>其中，&lt;code>createVideo&lt;/code> 方法是自己编写的工具方法，用于生成含有对应 &lt;code>customType&lt;/code> 的 &lt;code>video&lt;/code> 对象。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ts" data-lang="ts">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">mpegts&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s2">&amp;#34;mpegts.js&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">Mpegts&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s2">&amp;#34;mpegts.js&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">FlvJs&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s2">&amp;#34;flv.js&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">flvjs&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s2">&amp;#34;flv.js&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">Hls&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s2">&amp;#34;hls.js&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">import&lt;/span> &lt;span class="nx">dashjs&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">MediaPlayerClass&lt;/span>&lt;span class="p">}&lt;/span> &lt;span class="kr">from&lt;/span> &lt;span class="s2">&amp;#34;dashjs&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">enum&lt;/span> &lt;span class="nx">MesPlayerName&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">HttpFlvByMpegTsJs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;mpegTsJs&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">HttpFlvByFlvJs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;flvJs&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">HLSByHlsJs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;hlsJs&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">DASHByDashJs&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;dashJs&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">DASHByShaka&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;dashShaka&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">interface&lt;/span> &lt;span class="nx">IMsePlayerInfo&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">name&lt;/span>: &lt;span class="kt">MesPlayerName&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">player&lt;/span>: &lt;span class="kt">any&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">extension&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">title&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 创建播放器
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">createPlayer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">video&lt;/span>: &lt;span class="kt">HTMLVideoElement&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="k">void&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 加载直播流
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">loadPlayer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">video&lt;/span>: &lt;span class="kt">HTMLVideoElement&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="k">void&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">hasStream&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kr">boolean&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 卸载直播流
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">unloadPlayer&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="k">void&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">_mesPlayerList&lt;/span>: &lt;span class="kt">Array&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">IMsePlayerInfo&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">name&lt;/span>: &lt;span class="kt">MesPlayerName.HttpFlvByMpegTsJs&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">player&lt;/span>: &lt;span class="kt">null&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">Mpegts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Player&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">extension&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;flv&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">title&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;HTTP-FLV(mpegts.js)&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">createPlayer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">video&lt;/span>: &lt;span class="kt">HTMLVideoElement&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">streamUrl&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">video&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">src&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">mpegts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">createPlayer&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">type&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;flv&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isLive&lt;/span>: &lt;span class="kt">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">url&lt;/span>: &lt;span class="kt">streamUrl&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">loadPlayer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">video&lt;/span>: &lt;span class="kt">HTMLVideoElement&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`[videoEngine,flvJs,unloadPlayer]detach and unload mpegts.js player.`&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">attachMediaElement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">video&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">load&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">on&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">mpegts&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Events&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">LOADING_COMPLETE&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">()&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">play&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">unloadPlayer() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`[videoEngine,flvJs,unloadPlayer]detach and unload mpegts.js player.`&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">detachMediaElement&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unload&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="nx">hasStream() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isPlaying&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">name&lt;/span>: &lt;span class="kt">MesPlayerName.HttpFlvByFlvJs&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">player&lt;/span>: &lt;span class="kt">null&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">FlvJs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Player&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">extension&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;flv&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">title&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;HTTP-FLV(flv.js)&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">createPlayer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">video&lt;/span>: &lt;span class="kt">HTMLVideoElement&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">streamUrl&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">video&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">src&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">flvjs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">createPlayer&lt;/span>&lt;span class="p">({&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">type&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s1">&amp;#39;flv&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">isLive&lt;/span>: &lt;span class="kt">true&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">url&lt;/span>: &lt;span class="kt">streamUrl&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">loadPlayer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">video&lt;/span>: &lt;span class="kt">HTMLVideoElement&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`[videoEngine,flvJs,unloadPlayer]detach and unload flv.js player.`&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">attachMediaElement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">video&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">load&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">unloadPlayer() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`[videoEngine,flvJs,unloadPlayer]detach and unload flv.js player.`&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">detachMediaElement&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unload&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span> &lt;span class="nx">hasStream() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isPlaying&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">name&lt;/span>: &lt;span class="kt">MesPlayerName.HLSByHlsJs&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">player&lt;/span>: &lt;span class="kt">null&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">Hls&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">extension&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;m3u8&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">title&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;HLS(hls.js)&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">createPlayer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">video&lt;/span>: &lt;span class="kt">HTMLVideoElement&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kt">any&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Hls&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">loadPlayer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">video&lt;/span>: &lt;span class="kt">HTMLVideoElement&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">streamLink&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">video&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">src&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">loadSource&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">streamLink&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">attachMedia&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">video&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">unloadPlayer() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`[videoEngine,hlsJs,unloadPlayer]nothing todo with hls.js player.`&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">hasStream() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">isLevelLoaded&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">name&lt;/span>: &lt;span class="kt">MesPlayerName.DASHByDashJs&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">player&lt;/span>: &lt;span class="kt">null&lt;/span> &lt;span class="kr">as&lt;/span> &lt;span class="nx">MediaPlayerClass&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">extension&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;mpd&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">title&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;MPEG DASH(dash.js)&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">createPlayer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">video&lt;/span>: &lt;span class="kt">HTMLVideoElement&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="kt">any&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">dashjs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">MediaPlayer&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="nx">create&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">loadPlayer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">video&lt;/span>: &lt;span class="kt">HTMLVideoElement&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">streamLink&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">video&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">src&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">initialize&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">video&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">streamLink&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">false&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">updateSettings&lt;/span>&lt;span class="p">({&lt;/span>&lt;span class="nx">streaming&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">delay&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="nx">liveDelay&lt;/span>: &lt;span class="kt">10&lt;/span>&lt;span class="p">}}});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">unloadPlayer() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">reset&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`[videoEngine,hlsJs,unloadPlayer]nothing todo with hls.js player.`&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">hasStream() {&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">getPlayerInfo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">playerName&lt;/span>: &lt;span class="kt">MesPlayerName&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">IMsePlayerInfo&lt;/span> &lt;span class="o">|&lt;/span> &lt;span class="kc">undefined&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">playerInfo&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">_mesPlayerList&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">find&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">player&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">playerName&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="nx">playerInfo&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`[videoEngine,getPlayerInfo]can not find player named &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">playerName&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">.`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">playerInfo&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="kd">function&lt;/span> &lt;span class="nx">createVideo&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">playerName&lt;/span>: &lt;span class="kt">MesPlayerName&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">srsAddress&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">streamName&lt;/span>: &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">playerInfo&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">_mesPlayerList&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">find&lt;/span>&lt;span class="p">((&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="nx">player&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">playerName&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="nx">playerInfo&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`[videoEngine,createVideo]can not find player&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">playerName&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">.`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">streamUrl&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`//&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">srsAddress&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">:8080/live/&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">streamName&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">.&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">playerInfo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">extension&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">url&lt;/span>: &lt;span class="kt">streamUrl&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">type&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;streamPlayer&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">pic&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;./PM5644.webp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">customType&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">streamPlayer&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">video&lt;/span>: &lt;span class="kt">HTMLVideoElement&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="nx">playerInfo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">player&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">playerInfo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">createPlayer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">video&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">playerInfo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">hasStream&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">playerInfo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">unloadPlayer&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">playerInfo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">loadPlayer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">video&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>完整实现见：&lt;a class="link" href="https://github.com/nidbCN/live_room" target="_blank" rel="noopener"
>live_room&lt;/a>&lt;/p>
&lt;h2 id="参考">参考
&lt;/h2>&lt;ol>
&lt;li>&lt;a class="link" href="https://dplayer.diygod.dev/zh/guide.html#mse-%E6%94%AF%E6%8C%81" target="_blank" rel="noopener"
>指南 | DPlayer&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/Audio_and_video_delivery/Live_streaming_web_audio_and_video" target="_blank" rel="noopener"
>实时传输 Web 音频与视频 - Web 开发者指南 | MDN&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/video-dev/hls.js" target="_blank" rel="noopener"
>video-dev/hls.js: HLS.js is a JavaScript library that plays HLS in browsers with support for MSE.&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/Dash-Industry-Forum/dash.js" target="_blank" rel="noopener"
>Dash-Industry-Forum/dash.js: A reference client implementation for the playback of MPEG DASH via Javascript and compliant browsers.&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/shaka-project/shaka-player" target="_blank" rel="noopener"
>shaka-project/shaka-player: JavaScript player library / DASH &amp;amp; HLS client / MSE-EME player&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://github.com/xqq/mpegts.js" target="_blank" rel="noopener"
>xqq/mpegts.js: HTML5 MPEG2-TS / FLV Stream Player&lt;/a>&lt;/li>
&lt;/ol></description></item><item><title>使用 Grafana 监控你的 PromoxVE 集群</title><link>https://blog.gaein.cn/passages/pve-with-grafana/</link><pubDate>Mon, 03 Oct 2022 19:11:23 +0800</pubDate><guid>https://blog.gaein.cn/passages/pve-with-grafana/</guid><description>&lt;p>原来的虚拟机是一台实验用的设备，因为过度耦合，所以准备迁移到一台新开的专门提供服务的虚拟机，系统为 &lt;code>Ubuntu server 22.04 LTS&lt;/code>。&lt;/p>
&lt;p>本博客实际上是由旧的服务器向新的服务器迁移并且重新部署的过程中写的，因此 InfluxDB 没有使用最新的 &lt;code>2.4&lt;/code> 版本而是使用了 &lt;code>1.8.10&lt;/code>。&lt;/p>
&lt;p>&lt;img src="https://img.cdn.gaein.cn/website_used/blog/PVE-with-grafana/01.webp"
loading="lazy"
alt="概览"
>&lt;/p>
&lt;p>非常的帅气&lt;/p>
&lt;h2 id="influxdb">InfluxDB
&lt;/h2>&lt;h3 id="安装-influxdb">安装 InfluxDB
&lt;/h3>&lt;p>参考 &lt;a class="link" href="https://mirrors.tuna.tsinghua.edu.cn/help/influxdata/" target="_blank" rel="noopener"
>influxdata | 清华大学开源软件镜像站&lt;/a>&lt;/p>
&lt;p>TUNA 这里并没有适用于 Ubuntu 22.04 LTS 的选项，不过问题不大。&lt;/p>
&lt;p>向 &lt;code>/etc/apt/sources.list.d/influxdb.list&lt;/code> 写入：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">deb https://mirrors.tuna.tsinghua.edu.cn/influxdata/ubuntu/ jammy stable
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>添加公钥：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">wget -qO https://repos.influxdata.com/influxdb.key &lt;span class="p">|&lt;/span> sudo tee /etc/apt/trusted.gpg.d/influxdb.asc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>为什么不用 &lt;code>apt-key&lt;/code> ？因为已经废弃辣，详见 &lt;code>man apt-key&lt;/code>&lt;/p>&lt;/blockquote>
&lt;p>之后使用 &lt;code>apt install influxdb&lt;/code> 安装即可。&lt;/p>
&lt;h3 id="配置-influxdb">配置 InfluxDB
&lt;/h3>&lt;p>主要目的就是两个：开放 &lt;code>udp&lt;/code> 和 &lt;code>http&lt;/code> 连接。&lt;/p>
&lt;p>Promox VE 使用 udp 连接，Grafana 使用 http。&lt;/p>
&lt;p>修改 &lt;code>/etc/influxdb/influxdb.conf&lt;/code>&lt;/p>
&lt;p>&lt;code>[http]&lt;/code> 部分修改如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[http]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Determines whether HTTP endpoint is enabled.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> enabled = true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Determines whether the Flux query endpoint is enabled.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # flux-enabled = false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # Determines whether the Flux query logging is enabled.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # flux-log-enabled = false
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # The bind address used by the HTTP service.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bind-address = &amp;#34;:8086&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>取消 &lt;code>enabled&lt;/code> 和 &lt;code>bind-address&lt;/code> 的注释即可。&lt;/p>
&lt;p>&lt;code>udp&lt;/code> 部分修改如下&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[[udp]]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> enabled = true
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> bind-address = &amp;#34;:8089&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> database = &amp;#34;proxmox&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> # retention-policy = &amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>也是取消两个注释，然后将 &lt;code>database&lt;/code> 节点设置为 &lt;code>proxmox&lt;/code> 。&lt;/p>
&lt;p>还需要创建用户，因为我是从以前的迁移过来的，所以不需要再创建。&lt;/p>
&lt;h3 id="启用-influxdb">启用 InfluxDB
&lt;/h3>&lt;p>使用命令&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">systemctl start influxdb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>即可。&lt;/p>
&lt;p>如果报错类似于以下的&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-zed" data-lang="zed">&lt;span class="line">&lt;span class="cl">&lt;span class="n">run&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">open&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">server&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">open&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">tsdb&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">store&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">mkdir&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nn">var/lib/influxdb/data/_internal/&lt;/span>&lt;span class="n">_series&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">permission&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">denied&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>可能是因为使用过 &lt;code>root&lt;/code> 用户运行 &lt;code>influxd&lt;/code>。&lt;/p>
&lt;p>执行&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo chmod -R influxdb:influxdb /var/lib/influxdb/*
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>即可。&lt;/p>
&lt;h2 id="proxmox-ve">Proxmox VE
&lt;/h2>&lt;p>点击 &lt;code>DataCenter&lt;/code>，再点击 &lt;code>Metric Server&lt;/code>。&lt;/p>
&lt;p>依次点击 &lt;code>Add&lt;/code>，&lt;code>InfluxDB&lt;/code>，在 &lt;code>server&lt;/code> 处指定提供 InfluxDB 的虚拟机的 IP。&lt;/p>
&lt;h2 id="grafana">Grafana
&lt;/h2>&lt;h3 id="安装-grafana">安装 Grafana
&lt;/h3>&lt;p>依旧是参考 &lt;a class="link" href="https://mirrors.tuna.tsinghua.edu.cn/help/grafana/" target="_blank" rel="noopener"
>grafana | 清华大学开源软件镜像站&lt;/a> 。&lt;/p>
&lt;p>首先使用&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">wget -qO- https://packages.grafana.com/gpg.key &lt;span class="p">|&lt;/span> sudo tee /etc/apt/trusted.gpg.d/grafana.asc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">deb https://mirrors.tuna.tsinghua.edu.cn/grafana/apt/ stable main
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>写入 &lt;code>/etc/apt/sources.list.d/grafana.list&lt;/code>。&lt;/p>
&lt;p>然后执行：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo apt update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install grafana
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="配置-grafana">配置 Grafana
&lt;/h3>&lt;p>大部分配置都是从原服务器上恢复（因为实在不想重新设置面板了）&lt;/p>
&lt;ul>
&lt;li>/var/lib/grafana/grafana.db # 数据库文件&lt;/li>
&lt;li>/etc/grafana/grafana.ini # grafana配置文件&lt;/li>
&lt;li>/var/lib/grafana/plugins # 插件目录&lt;/li>
&lt;/ul>
&lt;h4 id="设置匿名访问">设置匿名访问
&lt;/h4>&lt;p>编辑配置文件，找到&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-ini" data-lang="ini">&lt;span class="line">&lt;span class="cl">&lt;span class="k">[auth.anonymous]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># enable anonymous access&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="na">enabled&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">true&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>取消注释并改为 &lt;code>true&lt;/code>。&lt;/p>
&lt;h2 id="nginx">Nginx
&lt;/h2>&lt;p>grafana 默认监听在 3000 端口，这样用起来非常的 low，这里使用 nginx 把 &lt;code>localhost:3000&lt;/code> 反向代理到 &lt;code>http://grafana-server/monitor/&lt;/code> 。&lt;/p>
&lt;p>修改配置文件 &lt;code>/etc/nginx/sites-enabled/default&lt;/code> ，在 &lt;code>server&lt;/code> 块内添加：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># Grafana
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">location /monitor/ {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header Host $host;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_set_header X-Real-IP $remote_addr;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> proxy_pass http://localhost:3000;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>MySQL常用命令：导入导出、创建数据库等</title><link>https://blog.gaein.cn/passages/mysql-usage/</link><pubDate>Fri, 17 Apr 2020 15:10:44 +0800</pubDate><guid>https://blog.gaein.cn/passages/mysql-usage/</guid><description>&lt;p>由于博客和其它的程序，经常要接触MySQL数据库。自己暑假想要学习PHP，肯定也要用到MySQL数据库。为了避免经常上网查常用的命令，就写篇博客备用。&lt;/p>
&lt;p>p.s. 为什么我感觉我从一个写桌面程序(CSharp.NET)的孩子变成了web运维(???)&lt;/p>
&lt;h2 id="相关链接">相关链接
&lt;/h2>&lt;p>&lt;a class="link" href="https://www.runoob.com/mysql" target="_blank" rel="noopener"
>菜鸟教程&lt;/a>
&lt;a class="link" href="https://www.mysql.com/downloads/" target="_blank" rel="noopener"
>MySQL官网下载&lt;/a>&lt;/p>
&lt;h2 id="终端命令">终端命令
&lt;/h2>&lt;h6 id="连接mysql">连接MySQL
&lt;/h6>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">mysql -p &lt;span class="c1">##使用root连接，如果需要在命令行中输入密码，则密码与&amp;#34;-p&amp;#34;之间没有空格&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>参数&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">-u &lt;span class="c1">##指定用户&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-p &lt;span class="c1">##密码（必选，新版MySQL已经不支持无密码登录）&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-P &lt;span class="c1">##端口，默认3306&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-h &lt;span class="c1">##服务器地址&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-D &lt;span class="c1">##数据库名&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h6 id="开启关闭mysql">开启、关闭MySQL
&lt;/h6>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">mysqladmin -u root -p shutdown &lt;span class="c1">##关闭MySQL，需要输入密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">##切记！千万不要使用kill等命令关闭MySQL，可能会造成数据损坏&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service mysqld start &lt;span class="c1">##启动MySQL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service mysqld status &lt;span class="c1">##查看运行状态&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h6 id="查看默认密码">查看默认密码
&lt;/h6>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo grep &lt;span class="s1">&amp;#39;temporary password&amp;#39;&lt;/span> /var/log/mysqld.log &lt;span class="c1">##刚安装完MySQL时候使用此命令查看初始化的密码&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="备份与恢复">备份与恢复
&lt;/h2>&lt;h6 id="备份导出sql文件">备份（导出.sql文件）
&lt;/h6>&lt;p>终端输入：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">mysqldump -u root -p 用户名 数据库名 &amp;gt; dump.sql
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h6 id="恢复导入sql文件">恢复（导入.sql文件）
&lt;/h6>&lt;p>MySQL输入：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="n">SOURCE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="err">文件路径&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h6 id="修复">修复
&lt;/h6>&lt;p>有时候错误的关闭MySQL会造成数据损害，此时可以尝试修复。MySQL内输入命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">CHECK&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">表名称&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="c1">##检查数据表是否损坏
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">REPAIRE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">表名称&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="c1">##修复损坏的表
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">REPAIR&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TABLE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">EXTENDED&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">表名称&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="c1">##速度慢，修复率高
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="mysql命令">MySQL命令
&lt;/h2>&lt;h6 id="用户管理">用户管理
&lt;/h6>&lt;blockquote>
&lt;p>新版MySQL的密码规则要求密码必须包含大小写字母、特殊字符、数字，并且长度在8个字符及以上。不符合会弹出&amp;quot;ERROR 1819 (HY000): Your password does not satisfy the current policy requirements&amp;quot;
在某些数据库中localhost可能是&amp;quot;%&amp;quot;
########## 新建用户&lt;/p>&lt;/blockquote>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">USER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;用户名&amp;#39;&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="s1">&amp;#39;localhost&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IDENTIFIED&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;密码&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>########## 添加权限&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">GRANT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">权限&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">数据库&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="err">数据表&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">TO&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;用户名&amp;#39;&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="s1">&amp;#39;localhost&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">WITH&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">GRANT&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">OPTION&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>其中权限有&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">1) 授予数据库权限时，&amp;lt;权限类型&amp;gt;可以指定为以下值：
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SELECT：表示授予用户可以使用 SELECT 语句访问特定数据库中所有表和视图的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INSERT：表示授予用户可以使用 INSERT 语句向特定数据库中所有表添加数据行的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DELETE：表示授予用户可以使用 DELETE 语句删除特定数据库中所有表的数据行的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">UPDATE：表示授予用户可以使用 UPDATE 语句更新特定数据库中所有数据表的值的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">REFERENCES：表示授予用户可以创建指向特定的数据库中的表外键的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CREATE：表示授权用户可以使用 CREATE TABLE 语句在特定数据库中创建新表的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ALTER：表示授予用户可以使用 ALTER TABLE 语句修改特定数据库中所有数据表的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SHOW VIEW：表示授予用户可以查看特定数据库中已有视图的视图定义的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CREATE ROUTINE：表示授予用户可以为特定的数据库创建存储过程和存储函数的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ALTER ROUTINE：表示授予用户可以更新和删除数据库中已有的存储过程和存储函数的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INDEX：表示授予用户可以在特定数据库中的所有数据表上定义和删除索引的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DROP：表示授予用户可以删除特定数据库中所有表和视图的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CREATE TEMPORARY TABLES：表示授予用户可以在特定数据库中创建临时表的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CREATE VIEW：表示授予用户可以在特定数据库中创建新的视图的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">EXECUTE ROUTINE：表示授予用户可以调用特定数据库的存储过程和存储函数的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LOCK TABLES：表示授予用户可以锁定特定数据库的已有数据表的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ALL 或 ALL PRIVILEGES：表示以上所有权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2) 授予表权限时，&amp;lt;权限类型&amp;gt;可以指定为以下值：
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">SELECT：授予用户可以使用 SELECT 语句进行访问特定表的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INSERT：授予用户可以使用 INSERT 语句向一个特定表中添加数据行的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DELETE：授予用户可以使用 DELETE 语句从一个特定表中删除数据行的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">DROP：授予用户可以删除数据表的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">UPDATE：授予用户可以使用 UPDATE 语句更新特定数据表的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ALTER：授予用户可以使用 ALTER TABLE 语句修改数据表的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">REFERENCES：授予用户可以创建一个外键来参照特定数据表的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CREATE：授予用户可以使用特定的名字创建一个数据表的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">INDEX：授予用户可以在表上定义索引的权限。
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ALL 或 ALL PRIVILEGES：所有的权限名。
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>（权限列表摘自biancheng.net）
########## 回收权限&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">REVOKE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">权限&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">ON&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">数据库&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="err">数据表&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;用户名&amp;#39;&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="s1">&amp;#39;localhost&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>########## 更改密码&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">USER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;用户名&amp;#39;&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="s1">&amp;#39;localhost&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IDENTIFIED&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;密码&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">##更改密码
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>########## 删除用户&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">USER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;用户名&amp;#39;&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="s1">&amp;#39;localhost&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h6 id="数据管理">数据管理
&lt;/h6>&lt;p>########## 列出数据库&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">SHOW&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DATABASES&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>########## 选中数据库&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">USE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">数据库名&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>########## 查看数据库大小&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">USE information_schema;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">select concat(round(sum(data_length/1024/1024),2),&amp;#39;MB&amp;#39;) as data from tables;##查看总大小
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">select concat(round(sum(data_length/1024/1024),2),&amp;#39;MB&amp;#39;) as data from tables where table_schema=&amp;#39;数据库名&amp;#39;;##查看指定数据库大小
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">select concat(round(sum(data_length/1024/1024),2),&amp;#39;MB&amp;#39;) as data from tables where table_schema=&amp;#39;数据库名&amp;#39; and table_name=&amp;#39;表名&amp;#39;;##查看指定表的大小
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>########## 新建数据库&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">CREATE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DATABASE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">数据库名&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>########## 删除数据库&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">DROP&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DATABASE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">数据库名&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>CentOS配置PHP+Nginx+MySQL——记一次环境配置的过程</title><link>https://blog.gaein.cn/passages/config-lnmp-on-centos/</link><pubDate>Thu, 16 Apr 2020 15:40:30 +0800</pubDate><guid>https://blog.gaein.cn/passages/config-lnmp-on-centos/</guid><description>&lt;h2 id="缘由">缘由
&lt;/h2>&lt;blockquote>
&lt;p>最近阿里云的服务器到期了，由于阿里云学生机活动规则更改了，而我手里的服务器已经升级无法再使用优惠价格续费。只好中转其它服务器，再将手里的第二台服务器退款。总之是很折腾的&lt;/p>&lt;/blockquote>
&lt;h2 id="过程">过程
&lt;/h2>&lt;p>我选择的安装方式并不是一键安装包、也没有用面板。总感觉那些东西安装完成之后不在自己习惯的位置。用着很不舒服，改配置文件还要搜索。所以我使用熟悉的yum来进行安装&lt;/p>
&lt;h3 id="使用我自己写的脚本">使用我自己写的脚本
&lt;/h3>&lt;p>&lt;code>wget https://res.gaein.cn/files/bash/init.sh&amp;amp;&amp;amp;sudo ./init/sh&lt;/code>&lt;/p>
&lt;p>进行自动化安装
（如果提示未知命令请先安装wget，参考下文）&lt;/p>
&lt;blockquote>
&lt;p>脚本因为用不到所以删了&lt;/p>&lt;/blockquote>
&lt;h3 id="安装基础软件i">安装基础软件I
&lt;/h3>&lt;p>包括&lt;/p>
&lt;ul>
&lt;li>wget (下载)&lt;/li>
&lt;li>tmux (终端复用)。&lt;/li>
&lt;/ul>
&lt;p>没有他们无法完成下一步的配置yum源。&lt;/p>
&lt;h4 id="安装wget">安装wget
&lt;/h4>&lt;p>使用命令 &lt;code>wget&lt;/code>&lt;/p>
&lt;p>如果输出&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">wget: missing URL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Usage: wget &lt;span class="o">[&lt;/span>OPTION&lt;span class="o">]&lt;/span>... &lt;span class="o">[&lt;/span>URL&lt;span class="o">]&lt;/span>...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Try &lt;span class="s1">&amp;#39;wget --help&amp;#39;&lt;/span> &lt;span class="k">for&lt;/span> more options.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>则已经安装wget。&lt;/p>
&lt;p>如果输出未知命令之类的，则使用 &lt;code>yum install -y wget&lt;/code> 安装wget。&lt;/p>
&lt;h4 id="安装tmux">安装tmux
&lt;/h4>&lt;blockquote>
&lt;p>tmux是一款优秀的终端复用神器，它可以在后端运行。也就是在里面运行的进程不会在你关闭SSH时结束。对于压缩转移大文件、下载大文件很有用（比如稍后我们安装MySQL用到将近一个小时，就是在tmux里面操作的）同时tmux还提供窗口切分、切换，让我们更方便的使用终端。&lt;/p>&lt;/blockquote>
&lt;p>&lt;strong>目前已知tmux和lrzsz不兼容&lt;/strong>&lt;/p>
&lt;p>&lt;img src="https://img.cdn.gaein.cn/website_used/blog/Config-LNMP-On-CentOS/01.webp"
loading="lazy"
alt="tmux截屏"
>&lt;/p>
&lt;p>使用命令 &lt;code>tmux --help&lt;/code> 来查看是否安装了tmux。如果输出&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">usage: tmux &lt;span class="o">[&lt;/span>-2CluvV&lt;span class="o">]&lt;/span> &lt;span class="o">[&lt;/span>-c shell-command&lt;span class="o">]&lt;/span> &lt;span class="o">[&lt;/span>-f file&lt;span class="o">]&lt;/span> &lt;span class="o">[&lt;/span>-L socket-name&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">[&lt;/span>-S socket-path&lt;span class="o">]&lt;/span> &lt;span class="o">[&lt;/span>&lt;span class="nb">command&lt;/span> &lt;span class="o">[&lt;/span>flags&lt;span class="o">]]&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>则已经安装，输出未知指令之类的，则使用 &lt;code>yum install -y tmux&lt;/code> 进行安装&lt;/p>
&lt;h5 id="使用tmux">使用tmux
&lt;/h5>&lt;p>tmux采用快捷键 &lt;code>Ctrl+B&lt;/code> 来激活控制台。同时按下键盘上面的&lt;code>Ctrl&lt;/code> 和 &lt;code>B&lt;/code> ，然后在按键盘就是tmux命令（快捷键）了。注意，使用 &lt;code>Ctrl+C&lt;/code> 无法强制结束tmux，只会结束里面的任务。
&lt;code>Ctrl+B&lt;/code> 后的常用快捷键（注意先按Ctrl+B再按下快捷键！）&lt;/p>
&lt;ul>
&lt;li>&lt;code>D&lt;/code>隐藏tmux（类似于windows的最小化，隐藏窗口而不退出，里面的进程继续）&lt;/li>
&lt;li>&lt;code>X&lt;/code>关闭tmux当前窗口（需要输入 &lt;code>y/n&lt;/code> 确定或取消）&lt;/li>
&lt;li>&lt;code>N&lt;/code>下一个窗口&lt;/li>
&lt;li>&lt;code>P&lt;/code>上一个窗口&lt;/li>
&lt;li>&lt;code>%&lt;/code>将窗口分为左右两块&lt;/li>
&lt;li>&lt;code>&amp;quot;&lt;/code>将窗口分为上下两块，注意是英文半角的&amp;quot;&lt;/li>
&lt;/ul>
&lt;p>记住这些命令也就暂时够了，其它的以后再研究&lt;/p>
&lt;h3 id="配置yum源">配置yum源
&lt;/h3>&lt;p>默认的yum源速度较慢、而且提供的软件不是很多。&lt;/p>
&lt;h4 id="配置epel">配置epel
&lt;/h4>&lt;p>使用命令 &lt;code>yum install -y epel-release&lt;/code> 安装epel&lt;/p>
&lt;h4 id="使用阿里镜像">使用阿里镜像
&lt;/h4>&lt;p>输入命令&lt;/p>
&lt;p>&lt;code>wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo&lt;/code>&lt;/p>
&lt;p>下载repo文件&lt;/p>
&lt;h4 id="配置webstatic">配置WebStatic
&lt;/h4>&lt;p>WebStatic提供最高到PHP7.2（目前我就需要PHP,yum默认的是PHP5.6）&lt;/p>
&lt;p>使用命令&lt;/p>
&lt;p>&lt;code>yum install -y https://mirror.WebStatic.com/yum/el7/WebStatic-release.rpm &lt;/code>&lt;/p>
&lt;p>安装rpm包&lt;/p>
&lt;p>配置完后别忘了使用&lt;/p>
&lt;p>&lt;code>yum clean all &amp;amp;&amp;amp; yum makecache&lt;/code> 来清空yum的缓存，使用 &lt;code>yum update&lt;/code> 来进行更新。&lt;/p>
&lt;h3 id="安装基础软件ii">安装基础软件II
&lt;/h3>&lt;p>操作服务器的一些常用软件。一般来说都预装的。可惜，我这神奇服务器没有。&lt;/p>
&lt;p>包括：&lt;/p>
&lt;ul>
&lt;li>vim(文本编辑)&lt;/li>
&lt;li>curl(下载)&lt;/li>
&lt;li>tar(tar压缩)&lt;/li>
&lt;li>7za(7z压缩)&lt;/li>
&lt;li>lrzsz(通过XShell终端传输文件)&lt;/li>
&lt;li>git&lt;/li>
&lt;/ul>
&lt;p>对于这些软件我无所谓版本，直接 &lt;code>yum install&lt;/code> 安装就可以(不说都是最新的也旧不了太多吧)&lt;/p>
&lt;p>这些软件都可以使用yum安装&lt;/p>
&lt;p>&lt;code>yum install -y curl lrzsz yum-utils vim p7zip git-core&lt;/code>&lt;/p>
&lt;h3 id="安装nginx">安装nginx
&lt;/h3>&lt;p>使用命令&lt;/p>
&lt;p>&lt;code>wget http://nginx.org/packages/centos/7/x86_64/RPMS/nginx-1.16.1-1.el7.ngx.x86_64.rpm &lt;/code>&lt;/p>
&lt;p>下载rpm包，然使用命令&lt;/p>
&lt;p>&lt;code>rpm -ivh nginx-1.16.1-1.el7.ngx.x86_64.rpm&lt;/code>&lt;/p>
&lt;p>安装nginx官方的rpm（版本1.16.1）需要其它可以自行到官方查看&lt;/p>
&lt;p>&lt;a class="link" href="https://nginx.org/packages/" target="_blank" rel="noopener"
>nginx官网&lt;/a>&lt;/p>
&lt;blockquote>
&lt;p>注意：使用 &lt;code>yum install nginx&lt;/code> 安装的为WebStatic源中的1.12版&lt;/p>&lt;/blockquote>
&lt;h4 id="常用命令">常用命令
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">nginx -v &lt;span class="c1">#查看nginx版本&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service nginx start&lt;span class="p">|&lt;/span>stop&lt;span class="p">|&lt;/span>restart &lt;span class="c1">#启动|停止|重启nginx服务&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx -t &lt;span class="c1">#检查配置文件是否正确&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx -s reload &lt;span class="c1">#重载配置文件&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nginx &lt;span class="c1">#启动nginx&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="安装php">安装PHP
&lt;/h3>&lt;p>使用命令&lt;/p>
&lt;p>&lt;code>yum install -y php72w-common php72w-fpm php72w-opcache php72w-gd php72w-mysqlnd php72w-mbstring php72w-pecl-redis php72w-pecl-memcached php72w-devel&lt;/code>&lt;/p>
&lt;p>进行安装&lt;/p>
&lt;p>这里安装了PHP PHP-FPM和一些常用模块，可以自行裁决。一般这些模块已经可以完美的支持WordPress、ZBlog等博客程序了&lt;/p>
&lt;blockquote>
&lt;p>如果想要安装PHP其它版本，把72w改成版本+w就可以咯&lt;/p>&lt;/blockquote>
&lt;h3 id="安装mysql">安装MySQL
&lt;/h3>&lt;p>参考以前写过的文章：&lt;/p>
&lt;p>&lt;a class="link" href="https://blog.gaein.cn/passages/MySQL8-CentOS7/" target="_blank" rel="noopener"
>CentOS部署MySQL8步骤&lt;/a>&lt;/p>
&lt;p>进行，这里只写主要步骤&lt;/p>
&lt;p>下载rpm&lt;/p>
&lt;p>&lt;code>wget https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm&lt;/code>&lt;/p>
&lt;p>//由于MySQL的rpm很大，所以采用先下载后安装&lt;/p>
&lt;p>使用命令导入MySQL rpm&lt;/p>
&lt;p>&lt;code>sudo rpm -Uvh mysql80-community-release-el7-3.noarch.rpm&lt;/code>&lt;/p>
&lt;p>使用命令&lt;/p>
&lt;p>&lt;code>yum install -y mysql-community-server &lt;/code>&lt;/p>
&lt;p>来安装&lt;/p>
&lt;h3 id="常用命令-1">常用命令
&lt;/h3>&lt;p>&lt;img src="https://img.cdn.gaein.cn/website_used/blog/Config-LNMP-On-CentOS/02.webp"
loading="lazy"
alt="mysql截屏"
>&lt;/p>
&lt;p>更多命令见 &lt;a class="link" href="https://blog.gaein.cn/passages/MySQL-usage/" target="_blank" rel="noopener"
>MySQL常用命令：导入导出、创建数据库等&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">service mysqld start &lt;span class="c1">##启动&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service mysqld status &lt;span class="c1">##查看状态&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo grep &lt;span class="s1">&amp;#39;temporary password&amp;#39;&lt;/span> /var/log/mysqld.log &lt;span class="c1">##查看默认密码&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mysql -u root -p &lt;span class="c1">##连接&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-mysql" data-lang="mysql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">ALTER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">USER&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;root&amp;#39;&lt;/span>&lt;span class="o">@&lt;/span>&lt;span class="s1">&amp;#39;localhost&amp;#39;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">IDENTIFIED&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">BY&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;pWD123456-&amp;#39;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">#更改密码
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">SHOW&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">DATABASES&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">#显示数据库
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">USE&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="err">数据库名&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">#切换到数据库
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">exit&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">#退出
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>CentOS部署MySQL8步骤</title><link>https://blog.gaein.cn/passages/install-mysql8-on-centos7/</link><pubDate>Mon, 15 Jul 2019 10:52:59 +0800</pubDate><guid>https://blog.gaein.cn/passages/install-mysql8-on-centos7/</guid><description>&lt;p>早就想去写的一篇博文，因为我在部署现在这个网站的服务器时，使用了最新版的MySQL，按照网上的教程安装出现了不少问题，写在这里备忘。&lt;/p>
&lt;!-- more -->
&lt;h2 id="获取rpm">获取rpm
&lt;/h2>&lt;ol>
&lt;li>访问 &lt;a class="link" href="https://www.mysql.com/downloads/" target="_blank" rel="noopener"
>https://www.mysql.com/downloads/&lt;/a>
&lt;img src="https://s2.ax1x.com/2019/07/15/ZoEUeO.md.png"
loading="lazy"
alt="MySQL官网的下载界面"
>
选择Yum Repository&lt;/li>
&lt;li>选择适合于自己系统的版本，比如我的是CentOS7，则选择这个，点击下载（Donwnload）
&lt;img src="https://s2.ax1x.com/2019/07/15/ZoEJQx.png"
loading="lazy"
alt="下载栏"
>&lt;/li>
&lt;li>忽略下载页面的登录提示，右键&amp;quot;No thanks,just start my download.&amp;quot;，复制连接
&lt;img src="https://s2.ax1x.com/2019/07/15/ZoEYy6.md.png"
loading="lazy"
alt="下载页面"
>&lt;/li>
&lt;li>连接到服务器，使用wget命令下载rpm&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">wget https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://s2.ax1x.com/2019/07/15/ZoEtOK.png"
loading="lazy"
alt="wget下载完成"
>&lt;/p>
&lt;h2 id="安装mysql">安装MySQL
&lt;/h2>&lt;ol>
&lt;li>导入rpm，使用命令：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo rpm -Uvh mysql80-community-release-el7-3.noarch.rpm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://s2.ax1x.com/2019/07/15/ZoEGS1.png"
loading="lazy"
alt="导入rpm"
>
2. 完成后使用：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> yum install mysql-community-server
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装MySQL社区版
&lt;img src="https://s2.ax1x.com/2019/07/15/ZoEawD.md.png"
loading="lazy"
alt="Mysql社区版安装"
>
提示后按y开始安装，会自动下载文件，可能需要一段时间，依网速和服务器位置而定
提示&amp;quot;Is this ok&amp;quot;时再次输入y并回车，确认
&lt;img src="https://s2.ax1x.com/2019/07/15/ZoEBYd.md.png"
loading="lazy"
alt="确认"
>&lt;/p>
&lt;h2 id="设置mysql">设置MySQL
&lt;/h2>&lt;ol>
&lt;li>启动MySQL
使用&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo service mysqld start
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>启动MySQL服务
使用&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">sudo service mysqld status
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看状态
&lt;img src="https://s2.ax1x.com/2019/07/15/ZoEylt.png"
loading="lazy"
alt="状态"
>
不能使用mysqld来启动，会启动失败
&lt;img src="https://s2.ax1x.com/2019/07/15/ZoEdTe.png"
loading="lazy"
alt="启动失败"
>
2. 连接到MySQL
MySQL8不支持无密码登录，在初次安装时就自动生成了root用户的密码
使用&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sudo&lt;/span> &lt;span class="n">grep&lt;/span> &lt;span class="s1">&amp;#39;temporary password&amp;#39;&lt;/span> &lt;span class="o">/&lt;/span>&lt;span class="k">var&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="nb">log&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">mysqld&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">log&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查看root用户的密码
&lt;img src="https://s2.ax1x.com/2019/07/15/ZoEDfA.png"
loading="lazy"
alt="查看密码"
>
使用&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mysql -u root -p
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>并输入默认密码（Linux系统输入密码时不会显示）
连接到MySQL服务器
&lt;img src="https://s2.ax1x.com/2019/07/15/ZoE66P.md.png"
loading="lazy"
alt="连接到MySQL"
>&lt;/p>
&lt;h2 id="修改默认密码">修改默认密码
&lt;/h2>&lt;p>连接到MySQL服务器后，使用&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">alter user &amp;#39;root&amp;#39;@&amp;#39;localhost&amp;#39;IDENTIFIED BY &amp;#39;pWD123456-&amp;#39;;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修改root的密码，其中&amp;rsquo;pWD123456-&amp;lsquo;是要修改成的新密码&lt;/p>
&lt;blockquote>
&lt;p>注意！MySQL8默认安装 validate_password 插件。这将要求密码包含至少一个大写字母，一个小写字母，一个数字和一个特殊字符，
并且密码总长度至少为8个字符。&lt;/p>&lt;/blockquote>
&lt;p>如果不符合密码规范，修改密码会失败&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ERROR 1819 (HY000): Your password does not satisfy the current policy requirements
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>修改成功会控制台输出&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">Query OK, 0 rows affected (0.01 sec)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://s2.ax1x.com/2019/07/15/Zoe76I.png"
loading="lazy"
alt="实例"
>
使用“exit”或“quit”命令退出MySQL&lt;/p></description></item><item><title>MySQL8服务器配置远程连接用户</title><link>https://blog.gaein.cn/passages/mysql8-connect/</link><pubDate>Mon, 15 Jul 2019 08:50:50 +0800</pubDate><guid>https://blog.gaein.cn/passages/mysql8-connect/</guid><description>&lt;p>最近需要有网站程序连接到数据库，但网站程序放在另外一个服务器上，所以需要设置数据库的远程连接。不同于网上给root远程连接权限的方法，我准备新建一个用户。&lt;/p>
&lt;!-- more -->
&lt;blockquote>
&lt;p>最近需要有网站程序连接到数据库，但网站程序放在另外一个服务器上，所以需要设置数据库的远程连接。不同于网上给root远程连接权限的方法，我准备新建一个用户。&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>服务器环境：
操作系统：CentOS7
MySQL版本：8.0.16 MySQL Community Server&lt;/p>&lt;/blockquote>
&lt;p>########## 首先，登录服务器ssh
使用&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">mysql -u root -p
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>并输入密码，进入mysql
由于我使用的是MySQL8，安全级别比以前高，不能同时创建用户并且赋值
首先创建用户&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">create user testuser@&amp;#39;%&amp;#39; identified by &amp;#39;TestUserPWD0&amp;#39;;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>再进行赋值&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">grant all privileges on *.* to testuser@&amp;#39;%&amp;#39; with grant option;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>刷新&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">flush privileges
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>因为MySQL8使用的是caching_sha2_password加密规则，所以为了方便连接，需要更改一下规则&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">ALTER USER &amp;#39;testuser&amp;#39;@&amp;#39;%&amp;#39; IDENTIFIED WITH mysql_native_password BY &amp;#39;TestUserPWD0&amp;#39;;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>########## 注意事项
testuser是你要创建的用户的用户名
TestUserPWD0是新创建的用户的密码
MySQL8默认安装 validate_password 插件。这将要求密码包含至少一个大写字母，一个小写字母，一个数字和一个特殊字符，并且密码总长度至少为8个字符。
如果无法连接，主要检查服务器防火墙或安全狗等规则限制&lt;/p></description></item><item><title>Ubuntu更改IP后重新配置网卡</title><link>https://blog.gaein.cn/passages/config-ubuntueth/</link><pubDate>Tue, 12 Feb 2019 21:04:35 +0800</pubDate><guid>https://blog.gaein.cn/passages/config-ubuntueth/</guid><description>&lt;p>编辑/etc/network/interfaces：&lt;/p>
&lt;p>&lt;code>vim /etc/network/interfaces&lt;/code>&lt;/p>
&lt;p>内容如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">auto lo
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iface lo inet loopback
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">auto eth0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">iface eth0 inet static //指定为静态
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">address 43.226.***.** //服务器IP
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">netmask 255.255.240.0 //网关
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">gateway 43.226.156.1 //子网掩码
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>不同的服务器或者不同的IDC配置文件有可能不同，请自行修改
修改完成后使用：&lt;/p>
&lt;p>&lt;code>sudo /etc/init.d/networking restart&lt;/code>&lt;/p>
&lt;p>重启网络设备&lt;/p></description></item><item><title>Linux挂载新硬盘</title><link>https://blog.gaein.cn/passages/linux-add-newdisk/</link><pubDate>Sat, 20 Oct 2018 12:07:15 +0800</pubDate><guid>https://blog.gaein.cn/passages/linux-add-newdisk/</guid><description>&lt;p>最近给Ubuntu添加了一块硬盘，下面是具体的步骤&lt;/p>
&lt;!-- more -->
&lt;p>
买的云服务器IDC给了一块10GB的数据盘，因为系统盘不大，就要把数据盘用上了
&lt;/p>
&lt;p>
但是Linux下数据盘并没有挂载，Linux的磁盘系统也不同于windows，需要挂载使用
&lt;/p>
&lt;h1 label="标题居左" style="font-size: 32px; font-weight: bold; border-bottom: 2px solid rgb(204, 204, 204); padding: 0px 4px 0px 0px; text-align: left; margin: 0px 0px 10px;">
1、新建分区并格式化&lt;br/>
&lt;/h1>
&lt;p>
使用
&lt;/p>
&lt;pre class="fy-prettyprint linenums">fdisk -l&lt;/pre>
&lt;p>
&lt;img src="https://s1.ax1x.com/2018/10/20/i04JfK.png" alt="" width="516" height="328"/>
&lt;/p>
&lt;p>
查看当前的硬盘，可以看到有sda、sdb两块盘，第一块作为系统盘已经分区，sdb就是我们要挂载的数据盘
&lt;/p>
&lt;p>
首先进行分区
&lt;/p>
&lt;pre class="fy-prettyprint linenums">fdisk /dev/sdb&lt;/pre>
&lt;p>
&lt;img src="https://s1.ax1x.com/2018/10/20/i048Fx.png" alt="" width="491" height="162"/>
&lt;/p>
&lt;p>
进入磁盘sdb（如果你是磁盘sdc就相应的替换为sdc）相当于选中这个硬盘的意思
&lt;/p>
&lt;p>
首先输入m看一下帮助
&lt;/p>
&lt;p>
&lt;img src="https://s1.ax1x.com/2018/10/20/i041T1.png" alt="" width="567" height="571"/>
&lt;/p>
&lt;p>
比较简单，应该很容易看懂，暂时把几个常用的写上了意思
&lt;/p>
&lt;pre class="fy-prettyprint linenums">Command (m for help): p ##显示磁盘信息
Disk /dev/sdb: 10 GiB, 10737418240 bytes, 20971520 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 4096 bytes
I/O size (minimum/optimal): 4096 bytes / 4096 bytes
Disklabel type: dos
Disk identifier: 0xb5106536
&lt;p>Command (m for help): n ##新建分区
Partition type
p primary (0 primary, 0 extended, 4 free)
e extended (container for logical partitions)
Select (default p): p ##新建逻辑分区
Partition number (1-4, default 1):
First sector (2048-20971519, default 2048):
Last sector, +sectors or +size{K,M,G,T,P} (2048-20971519, default 20971519):
##直接留空，我只想把所有的空间分一个分区
Created a new partition 1 of type &amp;amp;##39;Linux&amp;amp;##39; and of size 10 GiB.&lt;/p>
&lt;p>Command (m for help): w ##保存退出
The partition table has been altered.
Calling ioctl() to re-read partition table.
Syncing disks.&lt;/pre>&lt;/p>
&lt;p>
&lt;img src="https://s1.ax1x.com/2018/10/20/i04lwR.png" alt="" width="560" height="382"/>
&lt;/p>
&lt;p>
再次使用fdisk -l已经可以看到sdb有一个分区sdb1了
&lt;/p>
&lt;p>
&lt;img src="https://s1.ax1x.com/2018/10/20/i04tSO.png" alt="" width="511" height="397"/>
&lt;/p>
&lt;p>
同Windows一样，磁盘需要格式化后才能使用
&lt;/p>
&lt;p>
用
&lt;/p>
&lt;pre class="fy-prettyprint linenums">mkntfs /dev/sdb1&lt;/pre>
&lt;p>
来格式化为NTFS格式，其他格式可以自行百度
&lt;/p>
&lt;p>
&lt;img src="https://s1.ax1x.com/2018/10/20/i04GY6.png" alt="" width="391" height="57"/>
&lt;/p>
&lt;p>
出现
&lt;/p>
&lt;pre class="fy-prettyprint linenums">Cluster size has been automatically set to 4096 bytes.
Initializing device with zeroes: 100% - Done.
Creating NTFS volume structures.
mkntfs completed successfully. Have a nice day.&lt;/pre>
&lt;p>
即为格式化完成
&lt;/p>
&lt;h1 label="标题居中" style="font-size: 32px; font-weight: bold; border-bottom: 2px solid rgb(204, 204, 204); padding: 0px 4px 0px 0px; text-align: center; margin: 0px 0px 20px;">
2、挂载磁盘
&lt;/h1>
&lt;div>
&lt;p>
&lt;br/>
&lt;/p>
&lt;p>
临时挂载可以使用mount命令，但是重启后需要重新挂载
&lt;/p>
&lt;p>
用法为
&lt;/p>
&lt;pre class="fy-prettyprint linenums">mount 分区 目录&lt;/pre>
&lt;p>
比如我需要使用
&lt;/p>
&lt;pre class="fy-prettyprint linenums">mount /dev/sdb1 /data&lt;/pre>
&lt;p>
挂载
&lt;/p>
&lt;p>
&lt;img src="https://s1.ax1x.com/2018/10/20/i0IkGV.png" alt="" width="542" height="83"/>
&lt;/p>
&lt;p>
（当然前提是存在目录/data）
&lt;/p>
&lt;p>
编辑
&lt;/p>
&lt;pre class="prettyprint" name="code">/etc/fstab&lt;/pre>
&lt;p>
来永久挂载磁盘
&lt;/p>
&lt;pre class="fy-prettyprint linenums">## /etc/fstab: static file system information.
##
## Use &amp;##39;blkid&amp;##39; to print the universally unique identifier for a
## device; this may be used with UUID= as a more robust way to name devices
## that works even if disks are added and removed. See fstab(5).
##
## &amp;lt;file system&amp;gt; &amp;lt;mount point&amp;gt; &amp;lt;type&amp;gt; &amp;lt;options&amp;gt; &amp;lt;dump&amp;gt; &amp;lt;pass&amp;gt;
## / was on /dev/sda1 during installation
UUID=22e202f3-ae04-4995-b214-de7f192f33c4 / ext4 errors=remount-ro 0 1
## swap was on /dev/sda5 during installation
UUID=472580b3-a87b-4fe2-8bda-59b59d087ec6 none swap sw 0 0
/dev/fd0 /media/floppy0 auto rw,user,noauto,exec,utf8 0 0
/dev/sdb1 /data ntfs defaults 0 0
磁盘 挂载目录 磁盘格式&lt;/pre>
&lt;/div>
&lt;p>
需要注意的是，中间的空不需要打空格，用TAB制表符更方便&lt;br/>
&lt;/p>
&lt;pre class="fy-prettyprint linenums">root@rootadmin:/data## mkdir blog
root@rootadmin:/data## dir
blog
root@rootadmin:/data## reboot
Connection closing...Socket close.
&lt;p>Connection closed by foreign host.&lt;/p>
&lt;p>Disconnected from remote host(GAEIN.CN) at 12:21:20.&lt;/p>
&lt;p>Type `help&amp;amp;##39; to learn how to use Xshell prompt.
[C:~]$&lt;/p>
&lt;p>Connecting to &lt;em>.&lt;/em>.&lt;em>.&lt;/em>:22&amp;hellip;&lt;/p>
&lt;p>Connection established.
To escape to local shell, press &amp;amp;##39;Ctrl+Alt+]&amp;amp;##39;.&lt;/p>
&lt;p>Welcome to Ubuntu 18.04.1 LTS (GNU/Linux 4.15.0-38-generic x86_64)&lt;/p>
&lt;ul>
&lt;li>Documentation: &lt;a class="link" href="https://help.ubuntu.com" target="_blank" rel="noopener"
>https://help.ubuntu.com&lt;/a>&lt;/li>
&lt;li>Management: &lt;a class="link" href="https://landscape.canonical.com" target="_blank" rel="noopener"
>https://landscape.canonical.com&lt;/a>&lt;/li>
&lt;li>Support: &lt;a class="link" href="https://ubuntu.com/advantage" target="_blank" rel="noopener"
>https://ubuntu.com/advantage&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>System information as of Sat Oct 20 12:21:29 CST 2018&lt;/p>
&lt;p>System load: 0.49 Processes: 89
Usage of /: 24.9% of 12.67GB Users logged in: 0
Memory usage: 7% IP address for eth0: &lt;em>.&lt;/em>.&lt;em>.&lt;/em>
Swap usage: 0%&lt;/p>
&lt;ul>
&lt;li>Canonical Livepatch is available for installation.
&lt;ul>
&lt;li>Reduce system reboots and improve kernel security. Activate at:
&lt;a class="link" href="https://ubuntu.com/livepatch" target="_blank" rel="noopener"
>https://ubuntu.com/livepatch&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>0 个可升级软件包。
0 个安全更新。&lt;/p>
&lt;p>Failed to connect to &lt;a class="link" href="https://changelogs.ubuntu.com/meta-release-lts" target="_blank" rel="noopener"
>https://changelogs.ubuntu.com/meta-release-lts&lt;/a>. Check your Internet connection or proxy settings&lt;/p>
&lt;p>Last login: Sat Oct 20 11:26:33 2018 from &lt;em>.&lt;/em>.&lt;em>.&lt;/em>
rootadmin@rootadmin:~$ cd /data
rootadmin@rootadmin:/data$ dir
blog
rootadmin@rootadmin:/data$&lt;/pre>&lt;/p>
&lt;p>
重启了一下，挂载确实成功了&lt;br/>
&lt;/p></description></item><item><title>Ubuntu下apt“无法解析域名”解决方案</title><link>https://blog.gaein.cn/passages/fix-ubuntu-dns-error/</link><pubDate>Sat, 20 Oct 2018 11:42:39 +0800</pubDate><guid>https://blog.gaein.cn/passages/fix-ubuntu-dns-error/</guid><description>&lt;blockquote>
&lt;p>注意：本博客过于久远，内容可能已经不适用&lt;/p>&lt;/blockquote>
&lt;blockquote>
&lt;p>注意：正确的更改DNS的方法见博客：&lt;a class="link" href="https://blog.gaein.cn/passages/Public-DNS-and-configure-DNS" target="_blank" rel="noopener"
>常见公共DNS服务&amp;amp;Linux和Windows下修改DNS的方法&lt;/a>&lt;/p>&lt;/blockquote>
&lt;p>DNS莫名其妙出错，啥也干不了&lt;/p>
&lt;p>&lt;img src="https://img.cdn.gaein.cn/website_used/blog/Fix-Ubuntu-DNS-Error/01.webp"
loading="lazy"
alt="错误"
>&lt;/p>
&lt;p>百度了一波，发现解决方案很简单，就是手动加入DNS&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo vim /etc/resolv.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>加入DNS&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">nameserver 119.29.29.29
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>当然可以自己去百度其他家的DNS，我这是DNS PUBLIC+的地址&lt;/p>&lt;/blockquote>
&lt;p>按照百度说的我保存重启&lt;/p>
&lt;p>结果发现并没有什么卵用&amp;hellip;&lt;/p>
&lt;p>仔细观摩一下文件&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"># Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># 127.0.0.53 is the systemd-resolved stub resolver.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"># run &amp;#34;systemd-resolve --status&amp;#34; to see details about the actual nameservers.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nameserver 127.0.0.53&amp;lt;/pre&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>被覆盖了&lt;/p>
&lt;p>而且说明也写着“DO NOT EDIT THIS FILE BY HAND”&lt;/p>
&lt;p>我按照其他的方法修改了一下编辑resolv.conf.d目录下的base文件&lt;/p>
&lt;p>不过也没有效果&lt;/p>
&lt;p>但是按照第二篇看的文章找到了问题所在：&lt;/p>
&lt;p>重启系统后DNS设置不但不会被应用还会被覆盖，应该重启网卡来解决&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo /etc/init.d/networking restart&amp;lt;/pre&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>完美解决&lt;/p>
&lt;p>&lt;img src="https://img.cdn.gaein.cn/website_used/blog/Fix-Ubuntu-DNS-Error/02.webp"
loading="lazy"
alt="修复"
>&lt;/p>
&lt;p>参考：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="http://www.myexceptions.net/ai/1477082.html" target="_blank" rel="noopener"
>ubuntu apt-get 异常 Temporary failure resolving &amp;lsquo;us.archive.ubuntu.com&amp;rsquo; 解决 - 人工智能&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.csdn.net/tsq292978891/article/details/75039926" target="_blank" rel="noopener"
>ubuntu16.04 出现域名解析暂时失败 解决方法_tsq292978891的博客-CSDN博客_域名解析暂时失败&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.csdn.net/u012207345/article/details/78339218" target="_blank" rel="noopener"
>ubuntu域名解析失败解决方案_廿四桥明月夜的博客-CSDN博客_ubuntu域名解析失败&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>不过刚刚重启了好像又被覆盖了，很是绝望&lt;/p>
&lt;p>干脆写了个脚本，然后开机自动运行脚本得了&amp;hellip;&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### BEGIN INIT INFO&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Provides: run.sh &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Required-start: $local_fs $remote_fs $network $syslog &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Required-Stop: $local_fs $remote_fs $network $syslog &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Default-Start: 2 3 4 5 &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Default-Stop: 0 1 6 &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Short-Description: starts the run.shh daemon &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Description: starts run.sh using start-stop-daemon &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">### END INIT INFO&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo &lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;nameserver 119.29.29.29&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/resolv.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo /etc/init.d/networking restart
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后复制到init.d中，再&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">update-rc.d run.sh defaults 99
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item><item><title>Ubuntu终端更改为中文</title><link>https://blog.gaein.cn/passages/change-ubuntu-to-chinese/</link><pubDate>Fri, 17 Aug 2018 09:36:49 +0800</pubDate><guid>https://blog.gaein.cn/passages/change-ubuntu-to-chinese/</guid><description>&lt;p>由于本人英文渣，加之一个服务器终端是中文一个服务器终端是英文（当然两个服务器都穷的续不起了）&lt;/p>
&lt;p>所以今天更改Ubuntu的语言为中文&lt;/p>
&lt;p>因为是服务器所以只能通过终端更改&lt;/p>
&lt;p>首先安装下语言包&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo apt search language-pack-zh-hans
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>我先使用apt搜索了一下语言包&lt;/p>
&lt;p>&lt;img src="https://img.cdn.gaein.cn/website_used/blog/Change-Ubuntu-To-Chinese/01.webp"
loading="lazy"
alt="搜索结果"
>&lt;/p>
&lt;p>使用命令安装他们&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo apt install language-pack-zh-hans
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt install language-pack-zh-hans-base
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装下对于程序的语言支持&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo apt install &lt;span class="sb">`&lt;/span>check-language-support -l zh&lt;span class="sb">`&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>将语言设置为中文&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo localectl set-locale.UTF-8
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>重启系统&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo reboot
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>随便输入个什么命令，比如 &lt;code>date&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://img.cdn.gaein.cn/website_used/blog/Change-Ubuntu-To-Chinese/02.webp"
loading="lazy"
alt="显示"
>&lt;/p>
&lt;p>显示为中文，修改成功&lt;/p>
&lt;p>如果没有修改成功的话，使用文本编辑器编辑文件&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sh" data-lang="sh">&lt;span class="line">&lt;span class="cl">sudo vim /etc/default/locale
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://img.cdn.gaein.cn/website_used/blog/Change-Ubuntu-To-Chinese/03.webp"
loading="lazy"
alt="编辑文件"
>&lt;/p>
&lt;p>将 &lt;code>LANG LANGUAGE等&lt;/code> 后面换成&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">zh_CN.UTF-8
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://img.cdn.gaein.cn/website_used/blog/Change-Ubuntu-To-Chinese/04.webp"
loading="lazy"
alt="编辑文件内容"
>&lt;/p>
&lt;p>重启系统后就是中文了&lt;/p>
&lt;p>&lt;img src="https://img.cdn.gaein.cn/website_used/blog/Change-Ubuntu-To-Chinese/05.webp"
loading="lazy"
alt="中文显示"
>&lt;/p>
&lt;p>参考：&lt;/p>
&lt;ol>
&lt;li>&lt;a class="link" href="https://www.linuxdashen.com/ubuntu%e5%a6%82%e4%bd%95%e5%9c%a8%e7%bb%88%e7%ab%af%e4%b8%8b%e6%9b%b4%e6%94%b9%e7%b3%bb%e7%bb%9f%e8%af%ad%e8%a8%80" target="_blank" rel="noopener"
>ubuntu如何在终端下更改系统语言 - Linux大神博客&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://blog.csdn.net/cnylsy/article/details/52474433" target="_blank" rel="noopener"
>Ubuntu 14.04 英文SSH终端更改为中文显示_雅礼·实验-CSDN博客&lt;/a>&lt;/li>
&lt;/ol></description></item></channel></rss>